<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)</title>
<meta content="Marco Tiloca" name="author">
<meta content="Laurent Toutain" name="author">
<meta content="Ivan Martinez" name="author">
<meta content="Ana Minaburo" name="author">
<meta content="
       This document defines how to compress Constrained Application Protocol (CoAP) headers using the Static Context Header Compression and fragmentation (SCHC) framework. SCHC defines a header compression mechanism adapted for constrained devices. SCHC uses a static description of the header to reduce the header's redundancy and size. While RFC 8724 describes the SCHC compression and fragmentation framework, and its application for IPv6/UDP headers, this document applies SCHC to CoAP headers. The CoAP header structure differs from IPv6 and UDP, since CoAP uses a flexible header with a variable number of options, themselves of variable length. The CoAP message format is asymmetric: the request messages have a header format different from the format in the response messages. This specification gives guidance on applying SCHC to flexible headers and how to leverage the asymmetry for more efficient compression Rules. This document replaces and obsoletes RFC 8824. 
    " name="description">
<meta content="xml2rfc 3.23.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-schc-8824-update-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.2
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-schc-8824-update.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">SCHC for CoAP</td>
<td class="right">October 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca, et al.</td>
<td class="center">Expires 24 April 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">SCHC Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-schc-8824-update-latest</dd>
<dt class="label-obsoletes">Obsoletes:</dt>
<dd class="obsoletes">
<a href="https://www.rfc-editor.org/rfc/rfc8824" class="eref">8824</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-10-21" class="published">21 October 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-04-24">24 April 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">L. Toutain</div>
<div class="org">IMT Atlantique</div>
</div>
<div class="author">
      <div class="author-name">I. Martinez</div>
<div class="org">Nokia Bell Labs</div>
</div>
<div class="author">
      <div class="author-name">A. Minaburo</div>
<div class="org">Consultant</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines how to compress Constrained Application Protocol (CoAP) headers using the Static Context Header Compression and fragmentation (SCHC) framework. SCHC defines a header compression mechanism adapted for constrained devices. SCHC uses a static description of the header to reduce the header's redundancy and size. While RFC 8724 describes the SCHC compression and fragmentation framework, and its application for IPv6/UDP headers, this document applies SCHC to CoAP headers. The CoAP header structure differs from IPv6 and UDP, since CoAP uses a flexible header with a variable number of options, themselves of variable length. The CoAP message format is asymmetric: the request messages have a header format different from the format in the response messages. This specification gives guidance on applying SCHC to flexible headers and how to leverage the asymmetry for more efficient compression Rules. This document replaces and obsoletes RFC 8824.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Static Context Header Compression Working Group mailing list (schc@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/schc/">https://mailarchive.ietf.org/arch/browse/schc/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/marco-tiloca-sics/draft-ietf-schc-8824-update">https://github.com/marco-tiloca-sics/draft-ietf-schc-8824-update</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 24 April 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-schc-applicability-to-coap" class="internal xref">SCHC Applicability to CoAP</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-coap-headers-compressed-wit" class="internal xref">CoAP Headers Compressed with SCHC</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-differences-between-coap-an" class="internal xref">Differences between CoAP and UDP/IP Compression</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-compression-of-coap-header-" class="internal xref">Compression of CoAP Header Fields</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-coap-version-field" class="internal xref">CoAP Version Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-coap-type-field" class="internal xref">CoAP Type Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-coap-token-length-tkl-field" class="internal xref">CoAP Token Length (TKL) Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-coap-code-field" class="internal xref">CoAP Code Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-coap-message-id-field" class="internal xref">CoAP Message ID Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-coap-token-field" class="internal xref">CoAP Token Field</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-compression-of-coap-options" class="internal xref">Compression of CoAP Options</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-coap-option-content-format-" class="internal xref">CoAP Option Content-Format and Accept Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-coap-option-max-age-uri-hos" class="internal xref">CoAP Option Max-Age, Uri-Host, and Uri-Port Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-coap-option-uri-path-and-ur" class="internal xref">CoAP Option Uri-Path and Uri-Query Fields</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-variable-number-of-path-or-" class="internal xref">Variable Number of Path or Query Elements</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-coap-option-size1-size2-pro" class="internal xref">CoAP Option Size1, Size2, Proxy-Uri, and Proxy-Scheme Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-coap-option-proxy-cri-and-p" class="internal xref">CoAP Option Proxy-Cri and Proxy-Scheme-Number Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-coap-location-path-and-loca" class="internal xref">CoAP Location-Path and Location-Query Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="auto internal xref">5.7</a>.  <a href="#name-coap-option-etag-and-if-mat" class="internal xref">CoAP Option ETag and If-Match Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="auto internal xref">5.8</a>.  <a href="#name-coap-option-if-none-match" class="internal xref">CoAP Option If-None-Match</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9">
                <p id="section-toc.1-1.5.2.9.1"><a href="#section-5.9" class="auto internal xref">5.9</a>.  <a href="#name-coap-option-hop-limit-field" class="internal xref">CoAP Option Hop-Limit Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.10">
                <p id="section-toc.1-1.5.2.10.1"><a href="#section-5.10" class="auto internal xref">5.10</a>. <a href="#name-coap-option-echo-field" class="internal xref">CoAP Option Echo Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.11">
                <p id="section-toc.1-1.5.2.11.1"><a href="#section-5.11" class="auto internal xref">5.11</a>. <a href="#name-coap-option-request-tag-fie" class="internal xref">CoAP Option Request-Tag Field</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.12">
                <p id="section-toc.1-1.5.2.12.1"><a href="#section-5.12" class="auto internal xref">5.12</a>. <a href="#name-coap-option-edhoc-field" class="internal xref">CoAP Option EDHOC Field</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-compression-of-coap-extensi" class="internal xref">Compression of CoAP Extensions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-block-wise-transfers" class="internal xref">Block-Wise Transfers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-observe" class="internal xref">Observe</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-no-response" class="internal xref">No-Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-oscore" class="internal xref">OSCORE</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-compression-of-the-coap-pay" class="internal xref">Compression of the CoAP Payload Marker</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-examples-of-coap-header-com" class="internal xref">Examples of CoAP Header Compression</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-mandatory-header-with-con-m" class="internal xref">Mandatory Header with CON Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-oscore-compression" class="internal xref">OSCORE Compression</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-example-oscore-compression" class="internal xref">Example OSCORE Compression</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-coap-header-compression-wit" class="internal xref">CoAP Header Compression with Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-without-end-to-end-security" class="internal xref">Without End-to-End Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-with-end-to-end-security" class="internal xref">With End-to-End Security</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-examples-of-coap-header-comp" class="internal xref">Examples of CoAP Header Compression with Proxies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-without-end-to-end-security-2" class="internal xref">Without End-to-End Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-with-end-to-end-security-2" class="internal xref">With End-to-End Security</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-coap-fields" class="internal xref">CoAP Fields</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-yang-module" class="internal xref">YANG Module</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-ietf-xml" class="internal xref">IETF XML</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.  <a href="#name-yang-module-names" class="internal xref">YANG Module Names</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-13.3" class="auto internal xref">13.3</a>.  <a href="#name-schc-compression-of-coap-fi" class="internal xref">SCHC Compression of CoAP Fields</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3.2.1">
                    <p id="section-toc.1-1.13.2.3.2.1.1"><a href="#section-13.3.1" class="auto internal xref">13.3.1</a>.  <a href="#name-intended-use" class="internal xref">Intended Use</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3.2.2">
                    <p id="section-toc.1-1.13.2.3.2.2.1"><a href="#section-13.3.2" class="auto internal xref">13.3.2</a>.  <a href="#name-structure-of-entries" class="internal xref">Structure of Entries</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#section-13.4" class="auto internal xref">13.4</a>.  <a href="#name-expert-review-instructions" class="internal xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="auto internal xref">14.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="auto internal xref">14.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-yang-data-model" class="internal xref">YANG Data Model</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.3">
                <p id="section-toc.1-1.16.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> is a command/response protocol designed for microcontrollers with small RAM and ROM, and optimized for services based on REST (Representational State Transfer). Although the constrained devices are a leading factor in the design of CoAP, a CoAP header's size is still too large for LPWANs (Low-Power Wide-Area Networks). Static Context Header Compression and fragmentation (SCHC) over CoAP headers is required to increase performance or to use CoAP over LPWAN technologies.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> defines the SCHC framework, which includes a header compression mechanism for LPWANs that is based on a static context. <span><a href="https://rfc-editor.org/rfc/rfc8724#section-5" class="relref">Section 5</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> explains where compression and decompression occur in the architecture. The SCHC compression scheme assumes as a prerequisite that both endpoints know the static context before transmission. The way the context is configured, provisioned, or exchanged is out of this document's scope.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">CoAP is an application protocol, so CoAP compression requires installing common Rules between the two SCHC instances. SCHC compression may apply at two different levels: at the IP and UDP level in the LPWAN, as well as at the application level for CoAP. These two compression techniques may be independent. Both follow the same principle as that described in <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>. As different entities manage the CoAP compression process at different levels, the SCHC Rules driving the compression/decompression are also different. <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> describes how to use SCHC for IP and UDP headers. This document specifies how to apply SCHC compression to CoAP headers.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">SCHC compresses and decompresses headers based on common contexts between Devices. The SCHC context includes multiple Rules. Each Rule can match the header fields to specific values or ranges of values. If a Rule matches, the matched header fields are replaced by the RuleID and the Compression Residue that contains the residual bits of the compression. Thus, different Rules may correspond to different protocol headers in the packet that a Device expects to send or receive.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">A Rule describes the packets' entire header with an ordered list of Field Descriptors (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7" class="relref">Section 7</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>). In turn, each Field Descriptor contains the Field ID (FID), Field Length (FL), and Field Position (FP), as well as a Direction Indicator (DI) (upstream, downstream, or bidirectional) and some associated Target Values (TVs). The DI allows the compression to be based on the best TV for the Field Descriptor, when the TV to consider is different for the different transmission directions. Therefore, a field may be described several times in the same Rule.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Furthermore, a Matching Operator (MO) is associated with each header Field Descriptor. The Rule is selected if all the MOs fit the TVs for all the fields of the header. A Rule cannot be selected if the message contains a field that is unknown to the SCHC compressor.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">In that case, a Compression/Decompression Action (CDA) associated with each field specifies the method to compress and decompress that field. Compression mainly results in one of four actions:<a href="#section-1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-8.1">
          <p id="section-1-8.1.1">send the field value (value-sent),<a href="#section-1-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-8.2">
          <p id="section-1-8.2.1">send nothing (not-sent),<a href="#section-1-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-8.3">
          <p id="section-1-8.3.1">send some Least Significant Bits (LSBs) of the field, or<a href="#section-1-8.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-8.4">
          <p id="section-1-8.4.1">send an index (mapping-sent).<a href="#section-1-8.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-9">After applying the compression, there may be some bits to be sent. These values are called "Compression Residue".<a href="#section-1-9" class="pilcrow">¶</a></p>
<p id="section-1-10">SCHC is a general mechanism applied to different protocols, with the exact Rules to be used depending on the protocol and the application. <span><a href="https://rfc-editor.org/rfc/rfc8724#section-10" class="relref">Section 10</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> describes the compression scheme for IPv6 and UDP headers. This document targets CoAP header compression using SCHC.<a href="#section-1-10" class="pilcrow">¶</a></p>
<p id="section-1-11">The use of SCHC compression applied to CoAP headers was originally defined in <span>[<a href="#RFC8824" class="cite xref">RFC8824</a>]</span>. While this document does not alter the core approach, design choices, and features specified therein, this document clarifies, updates, and extends the SCHC compression of CoAP headers defined in <span>[<a href="#RFC8824" class="cite xref">RFC8824</a>]</span>.<a href="#section-1-11" class="pilcrow">¶</a></p>
<p id="section-1-12">In particular, this documents replaces and obsoletes <span>[<a href="#RFC8824" class="cite xref">RFC8824</a>]</span> as follows.<a href="#section-1-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-13.1">
          <p id="section-1-13.1.1">It provides clarifications and amendments to the original specification text, based on collected feedback and reported errata.<a href="#section-1-13.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.2">
          <p id="section-1-13.2.1">It clarifies how the SCHC compression handles CoAP options in general (see <a href="#sec-coap-options" class="auto internal xref">Section 5</a>).<a href="#section-1-13.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.3">
          <p id="section-1-13.3.1">It clarifies the SCHC compression for the CoAP options: Size1, Size2, Proxy-Uri, and Proxy-Scheme (see <a href="#ssec-size1-size2-proxy-uri-proxy-scheme-option" class="auto internal xref">Section 5.4</a>); ETag and If-Match (see <a href="#ssec-etag-if-match-option" class="auto internal xref">Section 5.7</a>); and If-None-Match (see <a href="#ssec-if-none-match" class="auto internal xref">Section 5.8</a>).<a href="#section-1-13.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.4">
          <p id="section-1-13.4.1">It defines the SCHC compression for the recently defined CoAP options Proxy-Cri and Proxy-Scheme-Number (see <a href="#ssec-proxy-cri-proxy-scheme-number-option" class="auto internal xref">Section 5.5</a>).<a href="#section-1-13.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.5">
          <p id="section-1-13.5.1">It defines the SCHC compression for the CoAP option Hop-Limit (see <a href="#coap-options-hop-limit" class="auto internal xref">Section 5.9</a>).<a href="#section-1-13.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.6">
          <p id="section-1-13.6.1">It defines the SCHC compression for the recently defined CoAP options Echo (see <a href="#coap-options-echo" class="auto internal xref">Section 5.10</a>), Request-Tag (see <a href="#coap-options-request-tag" class="auto internal xref">Section 5.11</a>), EDHOC (see <a href="#coap-options-edhoc" class="auto internal xref">Section 5.12</a>), as well as Q-Block1 and Q-Block2 (see <a href="#ssec-coap-extensions-block" class="auto internal xref">Section 6.1</a>).<a href="#section-1-13.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.7">
          <p id="section-1-13.7.1">It updates the SCHC compression processing for the CoAP option OSCORE (see <a href="#ssec-coap-extensions-oscore" class="auto internal xref">Section 6.4</a>), in the light of recent developments related to the security protocol OSCORE as defined in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span> and <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-1-13.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.8">
          <p id="section-1-13.8.1">It clarifies how the SCHC compression handles the CoAP payload marker (see <a href="#payload-marker" class="auto internal xref">Section 7</a>).<a href="#section-1-13.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-13.9">
          <p id="section-1-13.9.1">It defines the SCHC compression of CoAP headers in the presence of CoAP proxies (see <a href="#compression-with-proxies" class="auto internal xref">Section 9</a>), for which examples are provided (see <a href="#examples" class="auto internal xref">Section 10</a>).<a href="#section-1-13.9.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts related to the SCHC framework <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>, the web-transfer protocol CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, and the security protocols OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-applicability-to-coap">
<section id="section-2">
      <h2 id="name-schc-applicability-to-coap">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-schc-applicability-to-coap" class="section-name selfRef">SCHC Applicability to CoAP</a>
      </h2>
<p id="section-2-1">SCHC compression for CoAP headers <span class="bcp14">MAY</span> be done in conjunction with the lower layers (IPv6/UDP) or independently. The SCHC adaptation layers, described in <span><a href="https://rfc-editor.org/rfc/rfc8724#section-5" class="relref">Section 5</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>, may be used as shown in <a href="#fig-applicability-to-coap-1" class="auto internal xref">Figure 1</a>, <a href="#fig-applicability-to-coap-2" class="auto internal xref">Figure 2</a>, and <a href="#fig-applicability-to-coap-3" class="auto internal xref">Figure 3</a>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In the first example depicted in <a href="#fig-applicability-to-coap-1" class="auto internal xref">Figure 1</a>, a Rule compresses the complete header stack from IPv6 to CoAP. In this case, the Device and the Network Gateway (NGW) perform SCHC C/D (SCHC Compression/Decompression, see <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>). The application communicating with the Device does not implement SCHC C/D.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-compression-decompression-a"></span><div id="fig-applicability-to-coap-1">
<figure id="figure-1">
        <div id="section-2-3.1">
          <div class="alignCenter art-svg artwork" id="section-2-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="256" width="512" viewBox="0 0 512 256" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,224" fill="none" stroke="black"></path>
              <path d="M 80,64 L 80,232" fill="none" stroke="black"></path>
              <path d="M 128,128 L 128,232" fill="none" stroke="black"></path>
              <path d="M 200,160 L 200,224" fill="none" stroke="black"></path>
              <path d="M 264,128 L 264,224" fill="none" stroke="black"></path>
              <path d="M 432,64 L 432,224" fill="none" stroke="black"></path>
              <path d="M 504,64 L 504,224" fill="none" stroke="black"></path>
              <path d="M 8,64 L 80,64" fill="none" stroke="black"></path>
              <path d="M 432,64 L 504,64" fill="none" stroke="black"></path>
              <path d="M 8,96 L 80,96" fill="none" stroke="black"></path>
              <path d="M 432,96 L 504,96" fill="none" stroke="black"></path>
              <path d="M 8,128 L 80,128" fill="none" stroke="black"></path>
              <path d="M 128,128 L 264,128" fill="none" stroke="black"></path>
              <path d="M 432,128 L 504,128" fill="none" stroke="black"></path>
              <path d="M 8,160 L 80,160" fill="none" stroke="black"></path>
              <path d="M 128,160 L 264,160" fill="none" stroke="black"></path>
              <path d="M 432,160 L 504,160" fill="none" stroke="black"></path>
              <path d="M 8,192 L 80,192" fill="none" stroke="black"></path>
              <path d="M 128,192 L 200,192" fill="none" stroke="black"></path>
              <path d="M 8,224 L 80,224" fill="none" stroke="black"></path>
              <path d="M 128,224 L 264,224" fill="none" stroke="black"></path>
              <path d="M 432,224 L 504,224" fill="none" stroke="black"></path>
              <path d="M 56,240 L 80,240" fill="none" stroke="black"></path>
              <path d="M 128,240 L 152,240" fill="none" stroke="black"></path>
              <path d="M 248,240 L 288,240" fill="none" stroke="black"></path>
              <path d="M 400,240 L 448,240" fill="none" stroke="black"></path>
              <g class="text">
                <text x="44" y="36">(Device)</text>
                <text x="200" y="36">(NGW)</text>
                <text x="464" y="36">(App)</text>
                <text x="44" y="84">CoAP</text>
                <text x="468" y="84">CoAP</text>
                <text x="40" y="116">UDP</text>
                <text x="464" y="116">UDP</text>
                <text x="44" y="148">IPv6</text>
                <text x="196" y="148">IPv6</text>
                <text x="468" y="148">IPv6</text>
                <text x="44" y="180">SCHC</text>
                <text x="164" y="180">SCHC</text>
                <text x="48" y="212">LPWAN</text>
                <text x="160" y="212">LPWAN</text>
                <text x="104" y="244">LPWAN</text>
                <text x="348" y="244">Internet</text>
              </g>
            </svg><a href="#section-2-3.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-compression-decompression-a" class="selfRef">Compression/Decompression at the LPWAN Boundary</a>
        </figcaption></figure>
</div>
<p id="section-2-4"><a href="#fig-applicability-to-coap-1" class="auto internal xref">Figure 1</a> shows the use of SCHC header compression above Layer 2 in the Device and the NGW. The SCHC layer receives non-encrypted packets and can apply compression Rules to all the headers in the stack. On the other end, the NGW receives the SCHC packet and reconstructs the headers using the Rule and the Compression Residue. After the decompression, the NGW forwards the IPv6 packet toward the destination. The same process applies in the other direction when a non-encrypted packet arrives at the NGW. Thanks to the IP forwarding based on the IPv6 prefix, the NGW identifies the Device and compresses headers using the Device's Rules.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">In the second example depicted in <a href="#fig-applicability-to-coap-2" class="auto internal xref">Figure 2</a>, SCHC compression is applied in the CoAP layer, compressing the CoAP header independently of the other layers. The RuleID, Compression Residue, and CoAP payload are encrypted using a mechanism such as DTLS <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span>. Only the other end (App) can decipher the information. If needed, layers below use SCHC to compress the header as defined in <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> (represented by dotted lines in the figure).<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">This use case needs an end-to-end context initialization between the Device and the application. The context initialization is out of scope for this document.<a href="#section-2-6" class="pilcrow">¶</a></p>
<span id="name-standalone-coap-end-to-end-"></span><div id="fig-applicability-to-coap-2">
<figure id="figure-2">
        <div id="section-2-7.1">
          <div class="alignCenter art-svg artwork" id="section-2-7.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="320" width="512" viewBox="0 0 512 320" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,160" fill="none" stroke="black"></path>
              <path d="M 80,64 L 80,160" fill="none" stroke="black"></path>
              <path d="M 432,64 L 432,160" fill="none" stroke="black"></path>
              <path d="M 504,64 L 504,160" fill="none" stroke="black"></path>
              <path d="M 8,64 L 80,64" fill="none" stroke="black"></path>
              <path d="M 432,64 L 504,64" fill="none" stroke="black"></path>
              <path d="M 8,96 L 80,96" fill="none" stroke="black"></path>
              <path d="M 432,96 L 504,96" fill="none" stroke="black"></path>
              <path d="M 8,128 L 80,128" fill="none" stroke="black"></path>
              <path d="M 432,128 L 504,128" fill="none" stroke="black"></path>
              <path d="M 8,160 L 80,160" fill="none" stroke="black"></path>
              <path d="M 432,160 L 504,160" fill="none" stroke="black"></path>
              <path d="M 56,304 L 80,304" fill="none" stroke="black"></path>
              <path d="M 128,304 L 152,304" fill="none" stroke="black"></path>
              <path d="M 248,304 L 288,304" fill="none" stroke="black"></path>
              <path d="M 400,304 L 448,304" fill="none" stroke="black"></path>
              <g class="text">
                <text x="44" y="36">(Device)</text>
                <text x="200" y="36">(NGW)</text>
                <text x="464" y="36">(App)</text>
                <text x="44" y="84">CoAP</text>
                <text x="468" y="84">CoAP</text>
                <text x="44" y="116">SCHC</text>
                <text x="468" y="116">SCHC</text>
                <text x="44" y="148">DTLS</text>
                <text x="468" y="148">DTLS</text>
                <text x="8" y="180">.</text>
                <text x="40" y="180">udp</text>
                <text x="80" y="180">.</text>
                <text x="432" y="180">.</text>
                <text x="464" y="180">udp</text>
                <text x="504" y="180">.</text>
                <text x="44" y="196">..........</text>
                <text x="196" y="196">..................</text>
                <text x="468" y="196">..........</text>
                <text x="8" y="212">.</text>
                <text x="44" y="212">ipv6</text>
                <text x="80" y="212">.</text>
                <text x="128" y="212">.</text>
                <text x="196" y="212">ipv6</text>
                <text x="264" y="212">.</text>
                <text x="432" y="212">.</text>
                <text x="468" y="212">ipv6</text>
                <text x="504" y="212">.</text>
                <text x="44" y="228">..........</text>
                <text x="196" y="228">..................</text>
                <text x="468" y="228">..........</text>
                <text x="8" y="244">.</text>
                <text x="44" y="244">schc</text>
                <text x="80" y="244">.</text>
                <text x="128" y="244">.</text>
                <text x="164" y="244">schc</text>
                <text x="200" y="244">.</text>
                <text x="264" y="244">.</text>
                <text x="432" y="244">.</text>
                <text x="504" y="244">.</text>
                <text x="44" y="260">..........</text>
                <text x="164" y="260">..........</text>
                <text x="264" y="260">.</text>
                <text x="432" y="260">.</text>
                <text x="504" y="260">.</text>
                <text x="8" y="276">.</text>
                <text x="48" y="276">lpwan</text>
                <text x="80" y="276">.</text>
                <text x="128" y="276">.</text>
                <text x="160" y="276">lpwan</text>
                <text x="200" y="276">.</text>
                <text x="264" y="276">.</text>
                <text x="432" y="276">.</text>
                <text x="504" y="276">.</text>
                <text x="44" y="292">..........</text>
                <text x="196" y="292">..................</text>
                <text x="468" y="292">..........</text>
                <text x="104" y="308">LPWAN</text>
                <text x="348" y="308">Internet</text>
              </g>
            </svg><a href="#section-2-7.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-standalone-coap-end-to-end-" class="selfRef">Standalone CoAP End-to-End Compression/Decompression</a>
        </figcaption></figure>
</div>
<p id="section-2-8">The third example depicted in <a href="#fig-applicability-to-coap-3" class="auto internal xref">Figure 3</a> shows the use of Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. In this case, SCHC needs two Rules to compress the CoAP header. A first Rule focuses on the Inner header. The result of this first compression is encrypted using the OSCORE mechanism. Then, a second Rule compresses the Outer header, including the CoAP Option OSCORE.<a href="#section-2-8" class="pilcrow">¶</a></p>
<span id="name-oscore-compression-decompre"></span><div id="fig-applicability-to-coap-3">
<figure id="figure-3">
        <div id="section-2-9.1">
          <div class="alignCenter art-svg artwork" id="section-2-9.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="416" width="512" viewBox="0 0 512 416" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,256" fill="none" stroke="black"></path>
              <path d="M 80,64 L 80,256" fill="none" stroke="black"></path>
              <path d="M 432,64 L 432,256" fill="none" stroke="black"></path>
              <path d="M 504,64 L 504,256" fill="none" stroke="black"></path>
              <path d="M 8,64 L 80,64" fill="none" stroke="black"></path>
              <path d="M 432,64 L 504,64" fill="none" stroke="black"></path>
              <path d="M 8,112 L 80,112" fill="none" stroke="black"></path>
              <path d="M 432,112 L 504,112" fill="none" stroke="black"></path>
              <path d="M 8,160 L 80,160" fill="none" stroke="black"></path>
              <path d="M 432,160 L 504,160" fill="none" stroke="black"></path>
              <path d="M 8,208 L 80,208" fill="none" stroke="black"></path>
              <path d="M 432,208 L 504,208" fill="none" stroke="black"></path>
              <path d="M 8,256 L 80,256" fill="none" stroke="black"></path>
              <path d="M 432,256 L 504,256" fill="none" stroke="black"></path>
              <path d="M 56,400 L 80,400" fill="none" stroke="black"></path>
              <path d="M 128,400 L 152,400" fill="none" stroke="black"></path>
              <path d="M 248,400 L 288,400" fill="none" stroke="black"></path>
              <path d="M 400,400 L 448,400" fill="none" stroke="black"></path>
              <g class="text">
                <text x="44" y="36">(Device)</text>
                <text x="200" y="36">(NGW)</text>
                <text x="464" y="36">(App)</text>
                <text x="44" y="84">CoAP</text>
                <text x="468" y="84">CoAP</text>
                <text x="48" y="100">Inner</text>
                <text x="472" y="100">Inner</text>
                <text x="44" y="132">SCHC</text>
                <text x="468" y="132">SCHC</text>
                <text x="48" y="148">Inner</text>
                <text x="472" y="148">Inner</text>
                <text x="44" y="180">CoAP</text>
                <text x="468" y="180">CoAP</text>
                <text x="48" y="196">Outer</text>
                <text x="472" y="196">Outer</text>
                <text x="44" y="228">SCHC</text>
                <text x="468" y="228">SCHC</text>
                <text x="48" y="244">Outer</text>
                <text x="472" y="244">Outer</text>
                <text x="8" y="276">.</text>
                <text x="40" y="276">udp</text>
                <text x="80" y="276">.</text>
                <text x="432" y="276">.</text>
                <text x="464" y="276">udp</text>
                <text x="504" y="276">.</text>
                <text x="44" y="292">..........</text>
                <text x="196" y="292">..................</text>
                <text x="468" y="292">..........</text>
                <text x="8" y="308">.</text>
                <text x="44" y="308">ipv6</text>
                <text x="80" y="308">.</text>
                <text x="128" y="308">.</text>
                <text x="196" y="308">ipv6</text>
                <text x="264" y="308">.</text>
                <text x="432" y="308">.</text>
                <text x="468" y="308">ipv6</text>
                <text x="504" y="308">.</text>
                <text x="44" y="324">..........</text>
                <text x="196" y="324">..................</text>
                <text x="468" y="324">..........</text>
                <text x="8" y="340">.</text>
                <text x="44" y="340">schc</text>
                <text x="80" y="340">.</text>
                <text x="128" y="340">.</text>
                <text x="164" y="340">schc</text>
                <text x="200" y="340">.</text>
                <text x="264" y="340">.</text>
                <text x="432" y="340">.</text>
                <text x="504" y="340">.</text>
                <text x="44" y="356">..........</text>
                <text x="164" y="356">..........</text>
                <text x="264" y="356">.</text>
                <text x="432" y="356">.</text>
                <text x="504" y="356">.</text>
                <text x="8" y="372">.</text>
                <text x="48" y="372">lpwan</text>
                <text x="80" y="372">.</text>
                <text x="128" y="372">.</text>
                <text x="160" y="372">lpwan</text>
                <text x="200" y="372">.</text>
                <text x="264" y="372">.</text>
                <text x="432" y="372">.</text>
                <text x="504" y="372">.</text>
                <text x="44" y="388">..........</text>
                <text x="196" y="388">..................</text>
                <text x="468" y="388">..........</text>
                <text x="104" y="404">LPWAN</text>
                <text x="348" y="404">Internet</text>
              </g>
            </svg><a href="#section-2-9.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-oscore-compression-decompre" class="selfRef">OSCORE Compression/Decompression</a>
        </figcaption></figure>
</div>
<p id="section-2-10">In the case of several SCHC instances, as shown in <a href="#fig-applicability-to-coap-2" class="auto internal xref">Figure 2</a> and <a href="#fig-applicability-to-coap-3" class="auto internal xref">Figure 3</a>, the Rules may come from different provisioning domains.<a href="#section-2-10" class="pilcrow">¶</a></p>
<p id="section-2-11">This document focuses on CoAP compression, as represented by the dashed boxes in the previous figures.<a href="#section-2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-coap-header-compression">
<section id="section-3">
      <h2 id="name-coap-headers-compressed-wit">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-coap-headers-compressed-wit" class="section-name selfRef">CoAP Headers Compressed with SCHC</a>
      </h2>
<p id="section-3-1">The use of SCHC over the CoAP header applies the same description and compression/decompression techniques as the technique used for IP and UDP, as explained in <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>. For CoAP, the SCHC Rules description uses the direction information to optimize the compression by reducing the number of Rules needed to compress headers. The Field Descriptor <span class="bcp14">MAY</span> define both request/response headers and TVs in the same Rule, using the DI to indicate the header type.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">As for other header compression protocols, when the compressor does not find a correct Rule to compress the header, the packet <span class="bcp14">MUST</span> be sent uncompressed using the RuleID dedicated to this purpose, and where the Compression Residue is the complete header of the packet (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-6" class="relref">Section 6</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>).<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="ssec-differences-with-udp-ip">
<section id="section-3.1">
        <h3 id="name-differences-between-coap-an">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-differences-between-coap-an" class="section-name selfRef">Differences between CoAP and UDP/IP Compression</a>
        </h3>
<p id="section-3.1-1">CoAP compression differs from IPv6 and UDP compression in the following aspects:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">The CoAP message format is asymmetric, i.e., the headers are different for a request and a response.<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-3.1-2.1.2">
For example, the Uri-Path Option can be used in a request, while it is not used in a response. A request might contain an Accept Option, while both a request and a response might include a Content-Format Option. In comparison, the IPv6 and UDP returning path swaps the value of some fields in the header. However, all the directions have the same fields (e.g., source and destination address fields).<a href="#section-3.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-3.1-2.1.3"><span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> defines the use of a DI in the Field Descriptor, which allows a single Rule to process a message header differently, depending on the direction.<a href="#section-3.1-2.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">Even when a field is "symmetric" (i.e., found in both directions), the values carried in each direction are different. The compression may use a "match-mapping" MO to limit the range of expected values in a particular direction and reduce the Compression Residue's size. Through the DI, a Field Descriptor in the Rules splits the possible field value into two parts, one for each direction.<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-3.1-2.2.2">
For instance, if a client sends only Confirmable (CON) requests <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, the Type can be elided by compression, and the reply from the server may use one single bit to carry either the Acknowledgement (ACK) or Reset (RST) type. The field Code has the same behavior: the 0.0X code format value in a request and the Y.ZZ code format in a response.<a href="#section-3.1-2.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.3">
            <p id="section-3.1-2.3.1">In SCHC, the Rule defines the different header fields' length, so SCHC does not need to send it. In IPv6 and UDP headers, the fields have a fixed size, known by definition.<a href="#section-3.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3.1-2.3.2">
On the other hand, some CoAP header fields have variable lengths, and the Rule description specifies it. For example, the size of the Token field may vary from 0 to 8 bytes, and the CoAP options rely on the Type-Length-Value encoding format to specify the size of the actual option value in bytes.<a href="#section-3.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-3.1-2.3.3">
When doing SCHC compression of a variable-length field, <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> makes it possible to define a function for the Field Length in the Field Descriptor, in order to determine the length before compression. If the Field Length is unknown, the Rule will set it as a variable, and SCHC will send the compressed field's length in the Compression Residue.<a href="#section-3.1-2.3.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.4">
            <p id="section-3.1-2.4.1">A field can appear several times in the CoAP headers. This is typically the case for elements of a URI (i.e., path segments or query arguments). The SCHC specification <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> allows a FID to appear several times in the Rule and uses the Field Position (FP) to identify the correct instance, thereby removing the MO's ambiguity.<a href="#section-3.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.5">
            <p id="section-3.1-2.5.1">Field Lengths defined in CoAP can be too large when it comes to LPWAN traffic constraints. For instance, this is particularly true for the Message ID field and the Token field. SCHC uses different MOs to perform the compression (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4" class="relref">Section 7.4</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>). In this case, SCHC can apply the Most Significant Bits (MSBs) MO to reduce the information carried on LPWANs.<a href="#section-3.1-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-coap-fields-compression">
<section id="section-4">
      <h2 id="name-compression-of-coap-header-">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-compression-of-coap-header-" class="section-name selfRef">Compression of CoAP Header Fields</a>
      </h2>
<p id="section-4-1">This section discusses the SCHC compression of the CoAP header fields (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3" class="relref">Section 3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>), building on what is specified in <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.1" class="relref">Section 7.1</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="ssec-coap-version-field">
<section id="section-4.1">
        <h3 id="name-coap-version-field">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-coap-version-field" class="section-name selfRef">CoAP Version Field</a>
        </h3>
<p id="section-4.1-1">The Version field is described as bidirectional in a SCHC Rule, and it <span class="bcp14">MUST</span> be elided during SCHC compression, since it always contains the same value. In the future, or if a new version of CoAP is defined, new Rules will be needed to avoid ambiguities between versions.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-type-field">
<section id="section-4.2">
        <h3 id="name-coap-type-field">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-coap-type-field" class="section-name selfRef">CoAP Type Field</a>
        </h3>
<p id="section-4.2-1">The Type field specifies one of the four types of CoAP messages, encoded as specified in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3" class="relref">Section 3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>: Confirmable (CON), Non-confirmable (NON), Acknowledgement (ACK), and Reset (RST).<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The SCHC compression scheme <span class="bcp14">SHOULD</span> elide this field if, for instance, a client is sending only NON messages or only CON messages. For RST messages, SCHC may use a dedicated Rule. For other usages, SCHC can use a "match-mapping" MO.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-tkl-field">
<section id="section-4.3">
        <h3 id="name-coap-token-length-tkl-field">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-coap-token-length-tkl-field" class="section-name selfRef">CoAP Token Length (TKL) Field</a>
        </h3>
<p id="section-4.3-1">The Token Length (TKL) field specifies the size in bytes of the later Token field (see <a href="#ssec-coap-token-field" class="auto internal xref">Section 4.6</a>), and is described as bidirectional in a SCHC Rule.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">If the field value does not change over time, the SCHC Rule describes the TV set to that value, the MO set to "equal", and the CDA set to "not-sent", thereby eliding the field.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">Otherwise, if the field value changes over time, the SCHC Rule does not set the TV, while setting the MO to "ignore" and the CDA to "value-sent". The Rule may also use a "match-mapping" MO to compress the value.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-code-field">
<section id="section-4.4">
        <h3 id="name-coap-code-field">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-coap-code-field" class="section-name selfRef">CoAP Code Field</a>
        </h3>
<p id="section-4.4-1">The Code field takes value from the "Code" column of the "CoAP Codes" IANA registry, encoded as specified in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3" class="relref">Section 3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>. This field indicates the Method Code of a CoAP request or the Response Code of a CoAP Response, while the value 0.00 indicates an Empty message. The compression of the CoAP Code field follows the same principle as that of the CoAP Type field.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">If the Device plays a specific role, SCHC may split the code values into two Field Descriptors: (1) the Method Codes with the 0 class and (2) the Response Codes. SCHC will use the DI to identify the correct value in the packet. If the Device only implements a CoAP client, SCHC compression may focus only on the Method Codes that the client uses in its outgoing requests.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">For known values, SCHC can use a "match-mapping" MO. If SCHC cannot compress the Code field, it will send the values in the Compression Residue.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-message-id-field">
<section id="section-4.5">
        <h3 id="name-coap-message-id-field">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-coap-message-id-field" class="section-name selfRef">CoAP Message ID Field</a>
        </h3>
<p id="section-4.5-1">SCHC can compress the Message ID field with the MSB MO and the LSB CDA (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4" class="relref">Section 7.4</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>).<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-token-field">
<section id="section-4.6">
        <h3 id="name-coap-token-field">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-coap-token-field" class="section-name selfRef">CoAP Token Field</a>
        </h3>
<p id="section-4.6-1">A CoAP message fully specifies the Token by using two CoAP fields: the Token Length (TKL) field in the mandatory header (see <a href="#ssec-coap-tkl-field" class="auto internal xref">Section 4.3</a>) and the variable-length Token field that directly follows the mandatory CoAP header and specifies the Token value.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">For the Token field, SCHC <span class="bcp14">MUST NOT</span> send it as variable-size data in the Compression Residue, to avoid ambiguity with the Token Length field. Therefore, SCHC <span class="bcp14">MUST</span> use the value of the Token Length field to define the size of the Token field in the Compression Residue.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<p id="section-4.6-3">To this end, SCHC designates a specific function, "tkl", that the Rule <span class="bcp14">MUST</span> use to complete the Field Descriptor. During the decompression, this function returns the value contained in the Token Length field, hence the length of the Token field.<a href="#section-4.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-coap-options">
<section id="section-5">
      <h2 id="name-compression-of-coap-options">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-compression-of-coap-options" class="section-name selfRef">Compression of CoAP Options</a>
      </h2>
<p id="section-5-1">CoAP defines options placed after the mandatory header and the Token field, ordered by option number (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3" class="relref">Section 3</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>). As per <span><a href="https://rfc-editor.org/rfc/rfc7252#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, each option instance in a message uses the format Option Delta (D), Option Length (L), Option Value (V).<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">In particular, the Option Delta is used to express the option number of a CoAP option within a CoAP message, as the difference between the Option Number of that option and the Option Number of the previous option in that message (or zero for the first option). Also, the Option Length specifies the length of the Option Value, in bytes.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">In a SCHC Rule, the Field Descriptor related to a CoAP option is as follows:<a href="#section-5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">
          <p id="section-5-4.1.1">the FID is set to an unambiguous identifier of the CoAP option associated with the corresponding option number;<a href="#section-5-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-4.2">
          <p id="section-5-4.2.1">the FL is set to the Option Length L of the CoAP option, encoded as per <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.1" class="relref">Section 7.1</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>; and<a href="#section-5-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-4.3">
          <p id="section-5-4.3.1">the TV is set to the Option Value V of the CoAP option.<a href="#section-5-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-5">Note that the MO and the CDA specified in the Field Descriptor operates only on the Option Value V. That is, SCHC compression produces a residue from the Option Value V, while ignoring the option number, the Option Delta, and the Option Length. Therefore, the residue of a SCHC packet conveying a compressed CoAP header does not include the option number, the Option Delta, and the Option Length, which the recipient will be able to reconstruct by performing SCHC Decompression.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">When the Option Length has a well-known value, the Rule may specify the Option Length value in the FL of the Field Descriptor (see above). In such a case, SCHC compression treats the Option Value as a fixed-length field (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4.1" class="relref">Section 7.4.1</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>).<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">Otherwise, the Rule specifies the FL of the Field Descriptor as indicating a variable length, and SCHC compression treats the Option Value as a variable-length field (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>). In such a case, when the CDA specified in the Field Descriptor is "value-sent" or LSB, then SCHC compression additionally carries the length of the Compression Residue, as prepended to the Compression Residue value. Note that the length coding differs between CoAP options and the Compression Residue of SCHC variable-length fields.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">CoAP requests and responses do not include the same options. Compression Rules may reflect this asymmetry by using the DI.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">The following sections present how SCHC compresses some specific CoAP options. Unless otherwise indicated, the referred CoAP options are specified in <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-5-9" class="pilcrow">¶</a></p>
<p id="section-5-10">If the use of an additional CoAP option is later introduced, the SCHC Rules <span class="bcp14">MAY</span> be updated, in which case a new FID description <span class="bcp14">MUST</span> be assigned to perform the compression of the CoAP option. Otherwise, if no Rule describes that CoAP option, SCHC compression is not achieved, and SCHC sends the CoAP header without compression.<a href="#section-5-10" class="pilcrow">¶</a></p>
<div id="ssec-content-format-accept-option">
<section id="section-5.1">
        <h3 id="name-coap-option-content-format-">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-coap-option-content-format-" class="section-name selfRef">CoAP Option Content-Format and Accept Fields</a>
        </h3>
<p id="section-5.1-1">If the client expects a single specific value, SCHC can elide these fields, by specifying the value in the TV of a Rule description with an "equal" MO and a "not-sent" CDA.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">Otherwise, if the client expects several possible values, a "match-mapping" MO <span class="bcp14">SHOULD</span> be used to limit the Compression Residue's size. If not, SCHC has to send the option value in the Compression Residue (with fixed or variable length).<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-max-age-uri-host-uri-port-option">
<section id="section-5.2">
        <h3 id="name-coap-option-max-age-uri-hos">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-coap-option-max-age-uri-hos" class="section-name selfRef">CoAP Option Max-Age, Uri-Host, and Uri-Port Fields</a>
        </h3>
<p id="section-5.2-1">SCHC compresses these three fields in the same way. When the values of these options are known, SCHC can elide these fields. If the option uses well-known values, SCHC can use a "match-mapping" MO.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Otherwise, these options' values will be sent in the Compression Residue, i.e., the SCHC Rule description does not set the TV, while setting the MO to "ignore" and the CDA to "value-sent".<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-uri-path-uri-query-option">
<section id="section-5.3">
        <h3 id="name-coap-option-uri-path-and-ur">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-coap-option-uri-path-and-ur" class="section-name selfRef">CoAP Option Uri-Path and Uri-Query Fields</a>
        </h3>
<p id="section-5.3-1">The Uri-Path and Uri-Query fields are repeatable options, i.e., the CoAP header may include them several times and with different values. The SCHC Rule description uses the FP to distinguish the different instances of such options.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">To compress these repeatable field values, SCHC can use a "match-mapping" MO to reduce the size of variable paths or queries. When doing so, several elements can be regrouped into a single entry in order to optimize the compression. The numbering of elements does not change, and the first matching element sets the MO comparison.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">For example, as per the Rule descriptions shown in <a href="#_table-complex-path" class="auto internal xref">Table 1</a>, SCHC can use a single bit in the Compression Residue to code the path segments "/a/b" or the path segments "/c/d". If regrouping were not allowed, then 2 bits in the Compression Residue would be needed. At the same time, SCHC sends the third path element following "/a/b" or "/c/d" as a variable-size field in the Compression Residue.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<span id="name-complex-path-example"></span><div id="_table-complex-path">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-complex-path-example" class="selfRef">Complex Path Example</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">["/a/b", <br> "/c/d"]</td>
              <td class="text-left" rowspan="1" colspan="1">match-mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping-sent</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value-sent</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-5.3-5">The length of the Uri-Path and Uri-Query Options may be known when the Rule is defined. In any other case, SCHC <span class="bcp14">MUST</span> set the Field Length (FL) to a variable value. The unit of the variable length is bytes, hence the Compression Residue size is expressed in bytes, encoded as defined in <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">SCHC compression can use the MSB MO for a Uri-Path or Uri-Query element. In such a case, care must be taken when specifying the MSB parameter value in bits, which <span class="bcp14">MUST</span> be a multiple of 8. The length sent at the beginning of the variable-size field Compression Residue indicates the LSB's size in bytes, consistent with the unit of the variable length in the Rule description.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">For instance, for a CORECONF path /c/X6?k=eth0, the Rule description can be as shown in <a href="#_table-CoMicompress" class="auto internal xref">Table 2</a>. That is, SCHC compresses the first part of the Uri-Path with a "not-sent" CDA. Also, SCHC will send the second element of the Uri-Path preceded with the length (i.e., 0b0010 "X6"), which is followed by the query option preceded with the length (i.e., 0b0100 "eth0").<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<span id="name-coreconf-uri-compression"></span><div id="_table-CoMicompress">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-coreconf-uri-compression" class="selfRef">CORECONF URI compression</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"c"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value-sent</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Uri-Query</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"k="</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(16)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
            </tr>
          </tbody>
        </table>
</div>
<div id="variable-number-of-path-or-query-elements">
<section id="section-5.3.1">
          <h4 id="name-variable-number-of-path-or-">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-variable-number-of-path-or-" class="section-name selfRef">Variable Number of Path or Query Elements</a>
          </h4>
<p id="section-5.3.1-1">SCHC fixes the number of Uri-Path or Uri-Query elements in a Rule at Rule creation time. If the number of such elements varies, SCHC <span class="bcp14">SHOULD</span> either:<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-2.1">
              <p id="section-5.3.1-2.1.1">create several Rules to cover all possibilities; or<a href="#section-5.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-2.2">
              <p id="section-5.3.1-2.2.1">create a Rule that defines several entries for Uri-Path to cover the longest path, and send a Compression Residue with a length of 0 to indicate that a Uri-Path entry is empty.<a href="#section-5.3.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2.2.2">
However, this adds 4 bits to the variable Compression Residue size (see <span><a href="https://rfc-editor.org/rfc/rfc8724#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#RFC8724" class="cite xref">RFC8724</a>]</span>).<a href="#section-5.3.1-2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="ssec-size1-size2-proxy-uri-proxy-scheme-option">
<section id="section-5.4">
        <h3 id="name-coap-option-size1-size2-pro">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-coap-option-size1-size2-pro" class="section-name selfRef">CoAP Option Size1, Size2, Proxy-Uri, and Proxy-Scheme Fields</a>
        </h3>
<p id="section-5.4-1">The Size2 field is an option defined in <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span>.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">The SCHC Rule description <span class="bcp14">MAY</span> define sending some field values by not setting the TV, while setting the MO to "ignore" and the CDA to "value-sent". A Rule <span class="bcp14">MAY</span> also use a "match-mapping" MO when there are different alternatives for the same FID. Otherwise, the Rule sets the TV to a specific value, the MO to "equal", and the CDA to "not-sent".<a href="#section-5.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-proxy-cri-proxy-scheme-number-option">
<section id="section-5.5">
        <h3 id="name-coap-option-proxy-cri-and-p">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-coap-option-proxy-cri-and-p" class="section-name selfRef">CoAP Option Proxy-Cri and Proxy-Scheme-Number Fields</a>
        </h3>
<p id="section-5.5-1">The Proxy-Cri field is an option defined in <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>. The option carries an encoded CBOR data item <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> that represents an absolute CRI reference (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16#section-5" class="relref">Section 5</a> of [<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>). The option is used analogously to the Proxy-Uri option as defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2">The Proxy-Scheme-Number field is an option defined in <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>. The option carries a CRI Scheme Number represented as a CoAP unsigned integer (see Sections <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16#section-5.1.1" class="relref">5.1.1</a> and <a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16#section-8.1" class="relref">8.1</a> of <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>). The option is used analogously to the Proxy-Scheme option as defined in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>.<a href="#section-5.5-2" class="pilcrow">¶</a></p>
<p id="section-5.5-3">The SCHC Rule description <span class="bcp14">MAY</span> define sending some field values by not setting the TV, while setting the MO to "ignore" and the CDA to "value-sent". A Rule <span class="bcp14">MAY</span> also use a "match-mapping" MO when there are different alternatives for the same FID. Otherwise, the Rule sets the TV to a specific value, the MO to "equal", and the CDA to "not-sent".<a href="#section-5.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-location-path-location-query-option">
<section id="section-5.6">
        <h3 id="name-coap-location-path-and-loca">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-coap-location-path-and-loca" class="section-name selfRef">CoAP Location-Path and Location-Query Fields</a>
        </h3>
<p id="section-5.6-1">A Rule entry cannot store these fields' values. Therefore, SCHC compression <span class="bcp14">MUST</span> always send these values in the Compression Residue. That is, in the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent".<a href="#section-5.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-etag-if-match-option">
<section id="section-5.7">
        <h3 id="name-coap-option-etag-and-if-mat">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-coap-option-etag-and-if-mat" class="section-name selfRef">CoAP Option ETag and If-Match Fields</a>
        </h3>
<p id="section-5.7-1">When a CoAP message uses the ETag Option or the If-Match Option, SCHC compression <span class="bcp14">MAY</span> send its content in the Compression Residue. That is, in the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent". Alternatively, if a pre-defined set of values determined by the server is known and is used by the client as ETag values or If-Match values, then a Rule <span class="bcp14">MAY</span> use a "match-mapping" MO when there are different alternatives for the same FID.<a href="#section-5.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-if-none-match">
<section id="section-5.8">
        <h3 id="name-coap-option-if-none-match">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-coap-option-if-none-match" class="section-name selfRef">CoAP Option If-None-Match</a>
        </h3>
<p id="section-5.8-1">The If-None-Match Option occurs at most once and is always empty. The SCHC Rule <span class="bcp14">MUST</span> describe an empty TV, with the MO set to "equal" and the CDA set to "not-sent".<a href="#section-5.8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coap-options-hop-limit">
<section id="section-5.9">
        <h3 id="name-coap-option-hop-limit-field">
<a href="#section-5.9" class="section-number selfRef">5.9. </a><a href="#name-coap-option-hop-limit-field" class="section-name selfRef">CoAP Option Hop-Limit Field</a>
        </h3>
<p id="section-5.9-1">The Hop-Limit field is an option defined in <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span> that can be used to detect forwarding loops through a chain of CoAP proxies. The first proxy in the chain that understands the option includes it in a received request with a proper value set, before forwarding the request. Any following proxy that understands the option decrements the option value and forwards the request if the new value is different than zero, or returns a 5.08 (Hop Limit Reached) error response otherwise.<a href="#section-5.9-1" class="pilcrow">¶</a></p>
<p id="section-5.9-2">When a CoAP message uses the Hop-Limit Option, SCHC compression <span class="bcp14">SHOULD</span> send its content in the Compression Residue. That is, in the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent". As an exception, and consistently with the default value 16 defined for the Hop-Limit Option in <span><a href="https://rfc-editor.org/rfc/rfc8768#section-3" class="relref">Section 3</a> of [<a href="#RFC8768" class="cite xref">RFC8768</a>]</span>, a Rule <span class="bcp14">MAY</span> describe a TV with value 16, with the MO set to "equal" and the CDA set to "not-sent".<a href="#section-5.9-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coap-options-echo">
<section id="section-5.10">
        <h3 id="name-coap-option-echo-field">
<a href="#section-5.10" class="section-number selfRef">5.10. </a><a href="#name-coap-option-echo-field" class="section-name selfRef">CoAP Option Echo Field</a>
        </h3>
<p id="section-5.10-1">The Echo field is an option defined in <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span> that a server can include in a CoAP response as a challenge to the client, and that the client echoes back to the server in one or more CoAP requests. This enables the server to verify the freshness of a request and to cryptographically verify the aliveness of the client. Also, it forces the client to demonstrate reachability at its claimed network address.<a href="#section-5.10-1" class="pilcrow">¶</a></p>
<p id="section-5.10-2">When a CoAP message uses the Echo Option, SCHC compression <span class="bcp14">SHOULD</span> send its content in the Compression Residue. That is, in the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent". An exception applies in case the server generates the values to use for the Echo Option by means of a persistent counter (see <span><a href="https://rfc-editor.org/rfc/rfc9175#appendix-A" class="relref">Appendix A</a> of [<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>). In such a case, a Rule <span class="bcp14">MAY</span> use the MSB MO and the LSB CDA. This would be effectively applicable until the persistent counter at the server becomes greater than the maximum threshold value that produces an MSB-matching.<a href="#section-5.10-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coap-options-request-tag">
<section id="section-5.11">
        <h3 id="name-coap-option-request-tag-fie">
<a href="#section-5.11" class="section-number selfRef">5.11. </a><a href="#name-coap-option-request-tag-fie" class="section-name selfRef">CoAP Option Request-Tag Field</a>
        </h3>
<p id="section-5.11-1">The Request-Tag field is an option defined in <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span> that the client can set in CoAP requests throughout block-wise operations, with value an ephemeral short-lived identifier of the specific block-wise operation in question. This allows the server to match message fragments belonging to the same request operation and, if the server supports it, to reliably process simultaneous block-wise request operations on a single resource. If requests are integrity protected, this also protects against interchange of fragments between different block-wise request operations.<a href="#section-5.11-1" class="pilcrow">¶</a></p>
<p id="section-5.11-2">When a CoAP message uses the Request-Tag Option, SCHC compression <span class="bcp14">MAY</span> send its content in the Compression Residue. That is, in the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent". Alternatively, if a pre-defined set of Request-Tag values used by the client is known, a Rule <span class="bcp14">MAY</span> use a "match-mapping" MO when there are different alternatives for the same FID.<a href="#section-5.11-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coap-options-edhoc">
<section id="section-5.12">
        <h3 id="name-coap-option-edhoc-field">
<a href="#section-5.12" class="section-number selfRef">5.12. </a><a href="#name-coap-option-edhoc-field" class="section-name selfRef">CoAP Option EDHOC Field</a>
        </h3>
<p id="section-5.12-1">The EDHOC field is an option defined in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span> that a client can include in a CoAP request, in order to perform an optimized, shortened execution of the authenticated key exchange protocol EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>. Such a request conveys both the final EDHOC message and actual application data, where the latter is protected with OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> using a Security Context derived from the result of the current EDHOC execution.<a href="#section-5.12-1" class="pilcrow">¶</a></p>
<p id="section-5.12-2">The EDHOC Option occurs at most once and is always empty. The SCHC Rule <span class="bcp14">MUST</span> describe an empty TV, with the MO set to "equal" and the CDA set to "not-sent".<a href="#section-5.12-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-coap-extensions">
<section id="section-6">
      <h2 id="name-compression-of-coap-extensi">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-compression-of-coap-extensi" class="section-name selfRef">Compression of CoAP Extensions</a>
      </h2>
<div id="ssec-coap-extensions-block">
<section id="section-6.1">
        <h3 id="name-block-wise-transfers">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-block-wise-transfers" class="section-name selfRef">Block-Wise Transfers</a>
        </h3>
<p id="section-6.1-1">When a CoAP message uses a Block1 or Block2 Option <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span> or a Q-Block1 or Q-Block2 Option <span>[<a href="#RFC9177" class="cite xref">RFC9177</a>]</span>, SCHC compression <span class="bcp14">MUST</span> send its content in the Compression Residue. In the SCHC Rule, the TV is not set, while the MO is set to "ignore" and the CDA is set to "value-sent".<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">The Block1, Block2, Q-Block1, and Q-Block2 options allow fragmentation at the CoAP level that is compatible with SCHC fragmentation. Both fragmentation mechanisms are complementary, and the node may use them for the same packet as needed.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-extensions-observe">
<section id="section-6.2">
        <h3 id="name-observe">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-observe" class="section-name selfRef">Observe</a>
        </h3>
<p id="section-6.2-1"><span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> defines the Observe Option. The SCHC Rule description does not set the TV, while setting the MO to "ignore" and the CDA to "value-sent". SCHC does not limit the maximum size for this option (3 bytes). To reduce the transmission size, either the Device implementation <span class="bcp14">MAY</span> limit the delta between two consecutive values or a proxy can modify the increment.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">Since the client <span class="bcp14">MAY</span> use a RST message to inform a server that the Observe response is not required, a specific SCHC Rule <span class="bcp14">SHOULD</span> exist to allow the compression of a RST message.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-extensions-no-response">
<section id="section-6.3">
        <h3 id="name-no-response">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-no-response" class="section-name selfRef">No-Response</a>
        </h3>
<p id="section-6.3-1"><span>[<a href="#RFC7967" class="cite xref">RFC7967</a>]</span> defines a No-Response Option limiting the CoAP responses made by a server to a CoAP request. Different behaviors exist while using this option to limit the responses made by a server to a request. If both ends know the specific value, then the SCHC Rule describes the TV set to that value, the MO set to "equal", and the CDA set to "not-sent".<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Otherwise, if the value changes over time, the SCHC Rule does not set the TV, while setting the MO to "ignore" and the CDA to "value-sent". The Rule may also use a "match-mapping" MO to compress the value.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-coap-extensions-oscore">
<section id="section-6.4">
        <h3 id="name-oscore">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-oscore" class="section-name selfRef">OSCORE</a>
        </h3>
<p id="section-6.4-1">The security protocol OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> provides end-to-end protection for CoAP messages. Group OSCORE <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> builds on OSCORE and defines end-to-end protection of CoAP messages in group communication <span>[<a href="#I-D.ietf-core-groupcomm-bis" class="cite xref">I-D.ietf-core-groupcomm-bis</a>]</span>. This section describes how SCHC Rules can be applied to compress messages protected with OSCORE or Group OSCORE.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2"><a href="#fig-oscore-option" class="auto internal xref">Figure 4</a> shows the OSCORE Option value encoding, as it was originally defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. As explained later in this section, this has been extended in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span> and <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>. The first byte of the OSCORE Option value specifies information to parse the rest of the value by using flags, as described below.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-3.1">
            <p id="section-6.4-3.1.1">As defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-08#section-4.1" class="relref">Section 4.1</a> of [<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>, the eight least significant bit, when set, indicates that the OSCORE Option includes a second byte of flags. The seventh least significant bit is currently unassigned.<a href="#section-6.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-3.2">
            <p id="section-6.4-3.2.1">As defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23#section-5" class="relref">Section 5</a> of [<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>, the sixth least significant bit, when set, indicates that the message including the OSCORE option is protected with the group mode of Group OSCORE (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23#section-8" class="relref">Section 8</a> of [<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>). When not set, the bit indicates that the message is protected either with OSCORE, or with the pairwise mode of Group OSCORE (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23#section-9" class="relref">Section 9</a> of [<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span>), while the specific OSCORE Security Context used to protect the message determines which of the two cases applies.<a href="#section-6.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-3.3">
            <p id="section-6.4-3.3.1">As defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, bit h, when set, indicates the presence of the kid context field in the option. Also, bit k, when set, indicates the presence of the kid field. Finally, the three least significant bits form the n field, which indicates the length of the piv (Partial Initialization Vector) field in bytes. When n = 0, no piv is present.<a href="#section-6.4-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.4-4">Assuming the presence of a single flag byte, this is followed by the piv field. After that, if the h bit is set, the kid context field is present, preceded by one byte "s" indicating its length in bytes. After that, if the k bit is set, the kid field is present, and it ends where the OSCORE Option value ends.<a href="#section-6.4-4" class="pilcrow">¶</a></p>
<span id="name-oscore-option"></span><div id="fig-oscore-option">
<figure id="figure-4">
          <div class="alignCenter art-text artwork" id="section-6.4-5.1">
<pre>
 0 1 2 3 4 5 6 7 &lt;--------- n bytes -------------&gt;
+-+-+-+-+-+-+-+-+---------------------------------+
|0 0 0|h|k|  n  |        Partial IV (if any)      |
+-+-+-+-+-+-+-+-+---------------------------------+
|               |                                 |
|&lt;--   CoAP  --&gt;|&lt;------- CoAP OSCORE_piv ------&gt; |
   OSCORE_flags

 &lt;-- 1 byte --&gt; &lt;------ s bytes -----&gt;
+--------------+----------------------+-----------------------+
|  s (if any)  | kid context (if any) | kid (if any)      ... |
+--------------+----------------------+-----------------------+
|                                     |                       |
|&lt;-------- CoAP OSCORE_kidctx -------&gt;|&lt;-- CoAP OSCORE_kid --&gt;|
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-oscore-option" class="selfRef">OSCORE Option</a>
          </figcaption></figure>
</div>
<p id="section-6.4-6"><a href="#fig-oscore-option-kudos" class="auto internal xref">Figure 5</a> shows the extended OSCORE Option value encoding, with the second byte of flags also present. As defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-08#section-4.1" class="relref">Section 4.1</a> of [<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>, the least significant bit d of this byte, when set, indicates that two additional fields are included in the option, following the kid context field (if any).<a href="#section-6.4-6" class="pilcrow">¶</a></p>
<p id="section-6.4-7">These two fields, namely x and nonce, are used when running the key update protocol KUDOS defined in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>, with x specifying the length of the nonce field in bytes as well as the specific behavior to adopt during the KUDOS execution.<a href="#section-6.4-7" class="pilcrow">¶</a></p>
<p id="section-6.4-8">If the seventh least significant bit z of the x field is set, it indicates that two additional fields are included in the option, following the x and nonce fields. These two fields, namely y and old_nonce, are also used when running the key update protocol KUDOS, with y specifying the length of the old_nonce field in bytes.<a href="#section-6.4-8" class="pilcrow">¶</a></p>
<p id="section-6.4-9"><a href="#fig-oscore-option-kudos" class="auto internal xref">Figure 5</a> provides the breakdown of the x field, where its four least significant bits form the sub-field m, which specifies the size of nonce in bytes, minus 1. Also, the figure provides the breakdown of the y field, where its four least significant bits form the sub-field w, which specifies the size of old_nonce in bytes, minus 1.<a href="#section-6.4-9" class="pilcrow">¶</a></p>
<span id="name-oscore-option-extended-to-s"></span><div id="fig-oscore-option-kudos">
<figure id="figure-5">
          <div class="alignCenter art-text artwork" id="section-6.4-10.1">
<pre>
 0 1 2 3 4 5 6 7  8   9   10  11  12  13  14  15 &lt;----- n bytes -----&gt;
+-+-+-+-+-+-+-+-+---+---+---+---+---+---+---+---+---------------------+
|1|0|0|h|k|  n  | 0 | 0 | 0 | 0 | 0 | 0 | 0 | d | Partial IV (if any) |
+-+-+-+-+-+-+-+-+---+---+---+---+---+---+---+---+---------------------+
|                                               |                     |
|&lt;------------------- CoAP --------------------&gt;|&lt;- CoAP OSCORE_piv -&gt;|
                   OSCORE_flags

 &lt;- 1 byte -&gt; &lt;----------- s bytes ------------&gt;
+------------+----------------------------------+
| s (if any) |       kid context (if any)       |
+------------+----------------------------------+
|                                               |
|&lt;------------- CoAP OSCORE_kidctx ------------&gt;|


 &lt;------ 1 byte -----&gt; &lt;----- m + 1 bytes -----&gt;
+---------------------+-------------------------+
|     x (if any)      |      nonce (if any)     |
+---------------------+-------------------------+
|&lt;-- CoAP OSCORE_x --&gt;|&lt;-- CoAP OSCORE_nonce --&gt;|
|                     |
|   0 1 2 3 4 5 6 7   |
|  +-+-+-+-+-+-+-+-+  |
|  |0|z|b|p|   m   |  |
|  +-+-+-+-+-+-+-+-+  |


 &lt;------ 1 byte -----&gt;  &lt;------ w + 1 bytes ------&gt;
+---------------------+----------------------------+
|     y (if any)      |     old_nonce (if any)     |
+---------------------+----------------------------+
|&lt;-- CoAP OSCORE_y --&gt;|&lt;-- CoAP OSCORE_oldnonce --&gt;|
|                     |
|   0 1 2 3 4 5 6 7   |
|  +-+-+-+-+-+-+-+-+  |
|  |0|0|0|0|   w   |  |
|  +-+-+-+-+-+-+-+-+  |


+-----------------------+
|    kid (if any) ...   |
+-----------------------+
|                       |
|&lt;-- CoAP OSCORE_kid --&gt;|
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-oscore-option-extended-to-s" class="selfRef">OSCORE Option extended to support a KUDOS execution</a>
          </figcaption></figure>
</div>
<p id="section-6.4-11">To better perform OSCORE SCHC compression, the Rule description needs to identify the OSCORE Option and the fields it contains.<a href="#section-6.4-11" class="pilcrow">¶</a></p>
<p id="section-6.4-12">Conceptually, it discerns up to eight distinct pieces of information within the OSCORE Option: the flag bits, the piv, the kid context prepended by its size, the x byte, the nonce, the y byte, the old_nonce, and the kid. The SCHC Rule splits the OSCORE Option into eight corresponding Field Descriptors in order to compress those pieces of information:<a href="#section-6.4-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-13.1">
            <p id="section-6.4-13.1.1">CoAP OSCORE_flags<a href="#section-6.4-13.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.2">
            <p id="section-6.4-13.2.1">CoAP OSCORE_piv<a href="#section-6.4-13.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.3">
            <p id="section-6.4-13.3.1">CoAP OSCORE_kidctx<a href="#section-6.4-13.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.4">
            <p id="section-6.4-13.4.1">CoAP OSCORE_x<a href="#section-6.4-13.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.5">
            <p id="section-6.4-13.5.1">CoAP OSCORE_nonce<a href="#section-6.4-13.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.6">
            <p id="section-6.4-13.6.1">CoAP OSCORE_y<a href="#section-6.4-13.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.7">
            <p id="section-6.4-13.7.1">CoAP OSCORE_oldnonce<a href="#section-6.4-13.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-13.8">
            <p id="section-6.4-13.8.1">CoAP OSCORE_kid<a href="#section-6.4-13.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.4-14"><a href="#fig-oscore-option" class="auto internal xref">Figure 4</a> shows the original format of the OSCORE Option with the four fields OSCORE_flags, OSCORE_piv, OSCORE_kidctx, and OSCORE_kid superimposed on it. Also, <a href="#fig-oscore-option-kudos" class="auto internal xref">Figure 5</a> shows the extended format of the OSCORE option with all the eight fields superimposed on it.<a href="#section-6.4-14" class="pilcrow">¶</a></p>
<p id="section-6.4-15">If a field is not present, then the corresponding Field Descriptor in the SCHC Rule describes the TV set to b'', with the MO set to "equal" and the CDA set to "not-sent". Note that, if the field kid context is present, it directly includes the size octet, s.<a href="#section-6.4-15" class="pilcrow">¶</a></p>
<p id="section-6.4-16">In addition, the following applies.<a href="#section-6.4-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-17.1">
            <p id="section-6.4-17.1.1">For the x field, if both endpoints know the value, then the corresponding Field Descriptor in the SCHC Rule describes the TV set to that value, with the MO set to "equal" and the CDA set to "not-sent". This models: the case where the x field is not present, and thus TV is set to b''; and the case where the two endpoints run KUDOS with a pre-agreed size of the nonce field as per the m sub-field of the x field, as well as with a pre-agreed combination of its modes of operation, as per the bits b and p of the x field.<a href="#section-6.4-17.1.1" class="pilcrow">¶</a></p>
<p id="section-6.4-17.1.2">
Otherwise, if the value changes over time, then the corresponding Field Descriptor in the SCHC Rule does not set the TV, while it sets the MO to "ignore" and the CDA to "value-sent". The Rule may also use a "match-mapping" MO to compress this field, in case the two endpoints pre-agree on a set of alternative ways to run KUDOS, with respect to the size of the nonce field and the combination of the KUDOS modes of operation to use.<a href="#section-6.4-17.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-17.2">
            <p id="section-6.4-17.2.1">For the y field, if both endpoints know the value, then the corresponding Field Descriptor in the SCHC Rule describes the TV set to that value, with the MO set to "equal" and the CDA set to "not-sent". This models: the case where the y field is not present, and thus TV is set to b''; and the case where the two endpoints run KUDOS with a pre-agreed size of the old_nonce field as per the w sub-field of the y field.<a href="#section-6.4-17.2.1" class="pilcrow">¶</a></p>
<p id="section-6.4-17.2.2">
Otherwise, if the value changes over time, then the corresponding Field Descriptor in the SCHC Rule does not set the TV, while it sets the MO to "ignore" and the CDA to "value-sent". The Rule may also use a "match-mapping" MO to compress this field, in case the two endpoints pre-agree on a set of sizes of the old_nonce field.<a href="#section-6.4-17.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-17.3">
            <p id="section-6.4-17.3.1">For the nonce field, if it is not present (i.e., the x field is not present in the first place), then the corresponding Field Descriptor in the SCHC Rule describes the TV set to b'', with the MO set to "equal" and the CDA set to "not-sent".<a href="#section-6.4-17.3.1" class="pilcrow">¶</a></p>
<p id="section-6.4-17.3.2">
Otherwise, if the nonce field is present, then the corresponding Field Descriptor in the SCHC Rule has the TV not set, while the MO is set to "ignore" and the CDA is set to "value-sent". In such a case, for the value of the nonce field, SCHC <span class="bcp14">MUST NOT</span> send it as variable-length data in the Compression Residue, to avoid ambiguity with the length of the nonce field encoded in the x field. Therefore, SCHC <span class="bcp14">MUST</span> use the m sub-field of the x field to define the size of the Compression Residue. SCHC designates a specific function, "osc.x.m", that the Rule <span class="bcp14">MUST</span> use to complete the Field Descriptor. During the decompression, this function returns the length of the nonce field in bytes, as the value of the m sub-field of the x field, plus 1.<a href="#section-6.4-17.3.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-17.4">
            <p id="section-6.4-17.4.1">For the old_nonce field, if it is not present (i.e., the y field is not present in the first place), then the corresponding Field Descriptor in the SCHC Rule describes the TV set to b'', with the MO set to "equal" and the CDA set to "not-sent".<a href="#section-6.4-17.4.1" class="pilcrow">¶</a></p>
<p id="section-6.4-17.4.2">
Otherwise, if the old_nonce field is present, then the corresponding Field Descriptor in the SCHC Rule has the TV not set, while the MO is set to "ignore" and the CDA is set to "value-sent". In such a case, for the value of the old_nonce field, SCHC <span class="bcp14">MUST NOT</span> send it as variable-length data in the Compression Residue, to avoid ambiguity with the length of the old_nonce field encoded in the y field. Therefore, SCHC <span class="bcp14">MUST</span> use the w sub-field of the y field to define the size of the Compression Residue. SCHC designates a specific function, "osc.y.w", that the Rule <span class="bcp14">MUST</span> use to complete the Field Descriptor. During the decompression, this function returns the length of the old_nonce field in bytes, as the value of the w sub-field of the y field, plus 1.<a href="#section-6.4-17.4.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="payload-marker">
<section id="section-7">
      <h2 id="name-compression-of-the-coap-pay">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-compression-of-the-coap-pay" class="section-name selfRef">Compression of the CoAP Payload Marker</a>
      </h2>
<p id="section-7-1">The following applies with respect to the 0xFF payload marker. A SCHC compression Rule for CoAP includes all the expected CoAP options, therefore the payload marker does not have to be specified in a SCHC Rule description.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">If the CoAP message to compress with SCHC is not going to be protected with OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and includes a payload, then the 0xFF payload marker <span class="bcp14">MUST NOT</span> be included in the compressed message, which is composed of the Compression RuleID, the Compression Residue (if any), and the CoAP payload.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">After having decompressed an incoming message, the recipient endpoint <span class="bcp14">MUST</span> prepend the 0xFF payload marker to the CoAP payload, if any was present after the consumed Compression Residue.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">If the CoAP message to compress with SCHC is going to be protected with OSCORE, the 0xFF payload marker is compressed as specified later in <a href="#ssec-examples-oscore" class="auto internal xref">Section 8.2</a>.<a href="#section-7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-examples">
<section id="section-8">
      <h2 id="name-examples-of-coap-header-com">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-examples-of-coap-header-com" class="section-name selfRef">Examples of CoAP Header Compression</a>
      </h2>
<div id="ssec-examples-con-message">
<section id="section-8.1">
        <h3 id="name-mandatory-header-with-con-m">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-mandatory-header-with-con-m" class="section-name selfRef">Mandatory Header with CON Message</a>
        </h3>
<p id="section-8.1-1">In this first scenario, the SCHC compressor on the NGW side receives a POST message from an Internet client, which is immediately acknowledged by the Device. <a href="#_table-CoAP-header-1" class="auto internal xref">Table 3</a> describes the SCHC Rule descriptions for this scenario.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.1-2">
<pre>
+----------+
| RuleID 1 |
+----------+
</pre><a href="#section-8.1-2" class="pilcrow">¶</a>
</div>
<span id="name-coap-context-to-compress-he"></span><div id="_table-CoAP-header-1">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-coap-context-to-compress-he" class="selfRef">CoAP Context to compress header without Token</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">CON</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">[ACK, <br> RST]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">T</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">[0.00, <br> ... <br> 5.05]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC CCC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0000</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(7)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MID</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">"status"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-8.1-4">In this example, SCHC compression elides the version and Token Length fields. The 25 Method and Response Codes defined in <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> have been shrunk to 5 bits using a "match-mapping" MO. The Uri-Path contains a single element with the TV set to "status" and the CDA set to "not-sent", thereby eliding the single occurrence of the Uri-Path Option with value "status".<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">SCHC compression reduces the header, sending only a mapped Type (and only for uplink messages), a mapped code, and the least significant bits of the Message ID (9 bits in the example above).<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<p id="section-8.1-6">Note that, if a client is located in an Application Server and sends a request to a server located in the Device, then the request may not be compressed through this Rule, since the MID might not start with 7 bits equal to 0. A CoAP proxy placed before SCHC C/D can rewrite the Message ID to fit the value and match the Rule.<a href="#section-8.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec-examples-oscore">
<section id="section-8.2">
        <h3 id="name-oscore-compression">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-oscore-compression" class="section-name selfRef">OSCORE Compression</a>
        </h3>
<p id="section-8.2-1">OSCORE aims to solve the problem of end-to-end protection for CoAP messages. Therefore, the goal is to hide as much as possible of the CoAP message, while still enabling proxy operations.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">Conceptually, this is achieved by splitting the CoAP message into an Inner Plaintext and an Outer OSCORE message. The Inner Plaintext contains (sensitive) information that is not necessary for performing proxy operations. Therefore, that information can be encrypted end-to-end, until it reaches the other origin endpoint as its final destination. The Outer Message acts as a shell matching the regular CoAP message format, and includes all the CoAP options and information needed for performing proxy operations and caching. This is summarized in <a href="#fig-inner-outer" class="auto internal xref">Figure 6</a>.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">In particular, the CoAP options are arranged into three classes, each of which is granted a specific type of protection by the OSCORE protocol:<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-4.1">
            <p id="section-8.2-4.1.1">Class E: Encrypted options moved to the Inner Plaintext.<a href="#section-8.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-4.2">
            <p id="section-8.2-4.2.1">Class I: Integrity-protected options, included in the Additional Authenticated Data (AAD) when protecting the Plaintext, but otherwise left untouched in the Outer Message.<a href="#section-8.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-4.3">
            <p id="section-8.2-4.3.1">Class U: Unprotected options, left untouched in the Outer Message.<a href="#section-8.2-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-5">As per these classes, the Outer options comprise the OSCORE Option, which indicates that the message is protected with OSCORE and carries the information necessary for the recipient endpoint to retrieve the Security Context for decrypting the message.<a href="#section-8.2-5" class="pilcrow">¶</a></p>
<span id="name-coap-message-split-into-osc"></span><div id="fig-inner-outer">
<figure id="figure-6">
          <div id="section-8.2-6.1">
            <div class="alignCenter art-svg artwork" id="section-8.2-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="560" width="528" viewBox="0 0 528 560" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,368 L 8,456" fill="none" stroke="black"></path>
                <path d="M 8,480 L 8,528" fill="none" stroke="black"></path>
                <path d="M 24,368 L 24,400" fill="none" stroke="black"></path>
                <path d="M 40,368 L 40,400" fill="none" stroke="black"></path>
                <path d="M 64,496 L 64,528" fill="none" stroke="black"></path>
                <path d="M 72,368 L 72,400" fill="none" stroke="black"></path>
                <path d="M 144,48 L 144,136" fill="none" stroke="black"></path>
                <path d="M 144,160 L 144,272" fill="none" stroke="black"></path>
                <path d="M 144,368 L 144,400" fill="none" stroke="black"></path>
                <path d="M 160,48 L 160,80" fill="none" stroke="black"></path>
                <path d="M 176,48 L 176,80" fill="none" stroke="black"></path>
                <path d="M 200,176 L 200,208" fill="none" stroke="black"></path>
                <path d="M 208,48 L 208,80" fill="none" stroke="black"></path>
                <path d="M 224,480 L 224,496" fill="none" stroke="black"></path>
                <path d="M 272,48 L 272,80" fill="none" stroke="black"></path>
                <path d="M 272,368 L 272,400" fill="none" stroke="black"></path>
                <path d="M 312,400 L 312,432" fill="none" stroke="black"></path>
                <path d="M 360,160 L 360,176" fill="none" stroke="black"></path>
                <path d="M 360,368 L 360,528" fill="none" stroke="black"></path>
                <path d="M 400,48 L 400,80" fill="none" stroke="black"></path>
                <path d="M 400,208 L 400,272" fill="none" stroke="black"></path>
                <path d="M 424,368 L 424,400" fill="none" stroke="black"></path>
                <path d="M 424,432 L 424,464" fill="none" stroke="black"></path>
                <path d="M 440,80 L 440,112" fill="none" stroke="black"></path>
                <path d="M 520,400 L 520,432" fill="none" stroke="black"></path>
                <path d="M 520,464 L 520,528" fill="none" stroke="black"></path>
                <path d="M 144,48 L 400,48" fill="none" stroke="black"></path>
                <path d="M 144,80 L 408,80" fill="none" stroke="black"></path>
                <path d="M 144,112 L 400,112" fill="none" stroke="black"></path>
                <path d="M 144,176 L 360,176" fill="none" stroke="black"></path>
                <path d="M 144,208 L 400,208" fill="none" stroke="black"></path>
                <path d="M 144,272 L 400,272" fill="none" stroke="black"></path>
                <path d="M 8,368 L 272,368" fill="none" stroke="black"></path>
                <path d="M 360,368 L 424,368" fill="none" stroke="black"></path>
                <path d="M 8,400 L 280,400" fill="none" stroke="black"></path>
                <path d="M 360,400 L 472,400" fill="none" stroke="black"></path>
                <path d="M 8,432 L 272,432" fill="none" stroke="black"></path>
                <path d="M 360,432 L 480,432" fill="none" stroke="black"></path>
                <path d="M 360,464 L 520,464" fill="none" stroke="black"></path>
                <path d="M 8,496 L 224,496" fill="none" stroke="black"></path>
                <path d="M 8,528 L 64,528" fill="none" stroke="black"></path>
                <path d="M 360,528 L 520,528" fill="none" stroke="black"></path>
                <path d="M 332,280 L 372,360" fill="none" stroke="black"></path>
                <path d="M 164,360 L 204,280" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="380,360 368,354.4 368,365.6" fill="black" transform="rotate(63.43494882292201,372,360)"></polygon>
                <polygon class="arrowhead" points="172,360 160,354.4 160,365.6" fill="black" transform="rotate(116.56505117707799,164,360)"></polygon>
                <g class="text">
                  <text x="196" y="36">Original</text>
                  <text x="252" y="36">CoAP</text>
                  <text x="304" y="36">Message</text>
                  <text x="152" y="68">v</text>
                  <text x="168" y="68">t</text>
                  <text x="192" y="68">TKL</text>
                  <text x="236" y="68">code</text>
                  <text x="312" y="68">Message</text>
                  <text x="356" y="68">ID</text>
                  <text x="424" y="84">...</text>
                  <text x="176" y="100">Token</text>
                  <text x="420" y="116">....</text>
                  <text x="184" y="132">Options</text>
                  <text x="240" y="132">(IEU)</text>
                  <text x="360" y="132">|</text>
                  <text x="144" y="148">.</text>
                  <text x="360" y="148">.</text>
                  <text x="172" y="196">0xFF</text>
                  <text x="216" y="244">Payload</text>
                  <text x="48" y="356">Outer</text>
                  <text x="100" y="356">Header</text>
                  <text x="424" y="356">Plaintext</text>
                  <text x="16" y="388">v</text>
                  <text x="32" y="388">t</text>
                  <text x="56" y="388">TKL</text>
                  <text x="88" y="388">new</text>
                  <text x="124" y="388">code</text>
                  <text x="184" y="388">Message</text>
                  <text x="228" y="388">ID</text>
                  <text x="388" y="388">code</text>
                  <text x="296" y="404">...</text>
                  <text x="496" y="404">.....</text>
                  <text x="40" y="420">Token</text>
                  <text x="400" y="420">Options</text>
                  <text x="448" y="420">(E)</text>
                  <text x="292" y="436">....</text>
                  <text x="500" y="436">....</text>
                  <text x="48" y="452">Options</text>
                  <text x="100" y="452">(IU)</text>
                  <text x="224" y="452">|</text>
                  <text x="388" y="452">0xFF</text>
                  <text x="8" y="468">.</text>
                  <text x="224" y="468">.</text>
                  <text x="44" y="484">OSCORE</text>
                  <text x="100" y="484">Option</text>
                  <text x="400" y="500">Payload</text>
                  <text x="36" y="516">0xFF</text>
                </g>
              </svg><a href="#section-8.2-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-coap-message-split-into-osc" class="selfRef">CoAP Message Split into OSCORE Outer Header and Plaintext</a>
          </figcaption></figure>
</div>
<p id="section-8.2-7"><a href="#fig-inner-outer" class="auto internal xref">Figure 6</a> shows the packet format for the OSCORE Outer header and Plaintext.<a href="#section-8.2-7" class="pilcrow">¶</a></p>
<p id="section-8.2-8">In the Outer header, the original header code is hidden and replaced by a well-known value. As specified in Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-4.1.3.5" class="relref">4.1.3.5</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-4.2" class="relref">4.2</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, the original header code is replaced with POST for requests and Changed for responses, when the message does not include the Observe Option. Otherwise, the original header code is replaced with FETCH for requests and Content for responses.<a href="#section-8.2-8" class="pilcrow">¶</a></p>
<p id="section-8.2-9">The first byte of the Plaintext contains the original header code, the class E options, and, if present, the original message payload preceded by the payload marker.<a href="#section-8.2-9" class="pilcrow">¶</a></p>
<p id="section-8.2-10">After that, an Authenticated Encryption with Associated Data (AEAD) algorithm encrypts the Plaintext. This also integrity-protects the Security Context parameters and, if present, any class I options from the Outer header. The resulting ciphertext becomes the new payload of the OSCORE message, as illustrated in <a href="#fig-full-oscore" class="auto internal xref">Figure 7</a>.<a href="#section-8.2-10" class="pilcrow">¶</a></p>
<p id="section-8.2-11">As defined in <span>[<a href="#RFC5116" class="cite xref">RFC5116</a>]</span>, this ciphertext is the encrypted Plaintext's concatenation with the Authentication Tag. Note that Inner Compression only affects the Plaintext before encryption. The Authentication Tag, fixed in length and uncompressed, is considered part of the cost of protection.<a href="#section-8.2-11" class="pilcrow">¶</a></p>
<span id="name-oscore-message"></span><div id="fig-full-oscore">
<figure id="figure-7">
          <div class="alignCenter art-text artwork" id="section-8.2-12.1">
<pre>
   Outer Header
+-+-+---+--------+---------------+
|v|t|TKL|new code| Message ID    |
+-+-+---+--------+---------------+....+
| Token                               |
+--------------------------------.....+
| Options (IU)             |
.                          .
. OSCORE Option            .
+------+-------------------+
| 0xFF |
+------+---------------------------+
|                                  |
| Ciphertext: Encrypted Inner      |
|             Header and Payload   |
|             + Authentication Tag |
|                                  |
+----------------------------------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-oscore-message" class="selfRef">OSCORE Message</a>
          </figcaption></figure>
</div>
<p id="section-8.2-13">The SCHC compression scheme consists of compressing both the Plaintext before encryption and the resulting OSCORE message after encryption, as shown in <a href="#fig-OSCORE-Compression" class="auto internal xref">Figure 8</a>. Note that, since the recipient endpoint can only decrypt the Inner part of the message, that endpoint will also have to implement Inner SCHC Compression/Decompression.<a href="#section-8.2-13" class="pilcrow">¶</a></p>
<span id="name-oscore-compression-diagram"></span><div id="fig-OSCORE-Compression">
<figure id="figure-8">
          <div id="section-8.2-14.1">
            <div class="alignCenter art-svg artwork" id="section-8.2-14.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="592" width="576" viewBox="0 0 576 592" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,136" fill="none" stroke="black"></path>
                <path d="M 8,160 L 8,272" fill="none" stroke="black"></path>
                <path d="M 24,48 L 24,80" fill="none" stroke="black"></path>
                <path d="M 24,336 L 24,384" fill="none" stroke="black"></path>
                <path d="M 24,448 L 24,576" fill="none" stroke="black"></path>
                <path d="M 40,48 L 40,80" fill="none" stroke="black"></path>
                <path d="M 64,176 L 64,208" fill="none" stroke="black"></path>
                <path d="M 72,48 L 72,80" fill="none" stroke="black"></path>
                <path d="M 72,280 L 72,328" fill="none" stroke="black"></path>
                <path d="M 72,392 L 72,440" fill="none" stroke="black"></path>
                <path d="M 104,448 L 104,480" fill="none" stroke="black"></path>
                <path d="M 144,48 L 144,80" fill="none" stroke="black"></path>
                <path d="M 168,208 L 168,272" fill="none" stroke="black"></path>
                <path d="M 168,336 L 168,384" fill="none" stroke="black"></path>
                <path d="M 208,480 L 208,576" fill="none" stroke="black"></path>
                <path d="M 224,160 L 224,176" fill="none" stroke="black"></path>
                <path d="M 232,448 L 232,480" fill="none" stroke="black"></path>
                <path d="M 256,240 L 256,440" fill="none" stroke="black"></path>
                <path d="M 272,48 L 272,80" fill="none" stroke="black"></path>
                <path d="M 312,80 L 312,112" fill="none" stroke="black"></path>
                <path d="M 336,448 L 336,480" fill="none" stroke="black"></path>
                <path d="M 376,48 L 376,208" fill="none" stroke="black"></path>
                <path d="M 376,272 L 376,320" fill="none" stroke="black"></path>
                <path d="M 392,384 L 392,512" fill="none" stroke="black"></path>
                <path d="M 440,48 L 440,80" fill="none" stroke="black"></path>
                <path d="M 440,112 L 440,144" fill="none" stroke="black"></path>
                <path d="M 440,216 L 440,264" fill="none" stroke="black"></path>
                <path d="M 440,328 L 440,376" fill="none" stroke="black"></path>
                <path d="M 480,384 L 480,416" fill="none" stroke="black"></path>
                <path d="M 520,272 L 520,320" fill="none" stroke="black"></path>
                <path d="M 552,80 L 552,112" fill="none" stroke="black"></path>
                <path d="M 552,144 L 552,208" fill="none" stroke="black"></path>
                <path d="M 568,416 L 568,512" fill="none" stroke="black"></path>
                <path d="M 8,48 L 272,48" fill="none" stroke="black"></path>
                <path d="M 376,48 L 440,48" fill="none" stroke="black"></path>
                <path d="M 8,80 L 280,80" fill="none" stroke="black"></path>
                <path d="M 376,80 L 504,80" fill="none" stroke="black"></path>
                <path d="M 8,112 L 272,112" fill="none" stroke="black"></path>
                <path d="M 376,112 L 512,112" fill="none" stroke="black"></path>
                <path d="M 376,144 L 552,144" fill="none" stroke="black"></path>
                <path d="M 8,176 L 224,176" fill="none" stroke="black"></path>
                <path d="M 8,208 L 168,208" fill="none" stroke="black"></path>
                <path d="M 376,208 L 552,208" fill="none" stroke="black"></path>
                <path d="M 176,240 L 256,240" fill="none" stroke="black"></path>
                <path d="M 8,272 L 168,272" fill="none" stroke="black"></path>
                <path d="M 376,272 L 520,272" fill="none" stroke="black"></path>
                <path d="M 376,320 L 520,320" fill="none" stroke="black"></path>
                <path d="M 24,336 L 168,336" fill="none" stroke="black"></path>
                <path d="M 24,384 L 168,384" fill="none" stroke="black"></path>
                <path d="M 392,384 L 480,384" fill="none" stroke="black"></path>
                <path d="M 392,416 L 568,416" fill="none" stroke="black"></path>
                <path d="M 24,448 L 104,448" fill="none" stroke="black"></path>
                <path d="M 232,448 L 336,448" fill="none" stroke="black"></path>
                <path d="M 392,448 L 568,448" fill="none" stroke="black"></path>
                <path d="M 344,464 L 384,464" fill="none" stroke="black"></path>
                <path d="M 24,480 L 208,480" fill="none" stroke="black"></path>
                <path d="M 232,480 L 336,480" fill="none" stroke="black"></path>
                <path d="M 24,512 L 208,512" fill="none" stroke="black"></path>
                <path d="M 392,512 L 568,512" fill="none" stroke="black"></path>
                <path d="M 24,576 L 208,576" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="448,376 436,370.4 436,381.6" fill="black" transform="rotate(90,440,376)"></polygon>
                <polygon class="arrowhead" points="448,264 436,258.4 436,269.6" fill="black" transform="rotate(90,440,264)"></polygon>
                <polygon class="arrowhead" points="352,464 340,458.4 340,469.6" fill="black" transform="rotate(180,344,464)"></polygon>
                <polygon class="arrowhead" points="184,240 172,234.4 172,245.6" fill="black" transform="rotate(180,176,240)"></polygon>
                <polygon class="arrowhead" points="80,440 68,434.4 68,445.6" fill="black" transform="rotate(90,72,440)"></polygon>
                <polygon class="arrowhead" points="80,328 68,322.4 68,333.6" fill="black" transform="rotate(90,72,328)"></polygon>
                <g class="text">
                  <text x="48" y="36">Outer</text>
                  <text x="104" y="36">Message</text>
                  <text x="404" y="36">OSCORE</text>
                  <text x="472" y="36">Plaintext</text>
                  <text x="16" y="68">v</text>
                  <text x="32" y="68">t</text>
                  <text x="56" y="68">TKL</text>
                  <text x="88" y="68">new</text>
                  <text x="124" y="68">code</text>
                  <text x="184" y="68">Message</text>
                  <text x="228" y="68">ID</text>
                  <text x="404" y="68">code</text>
                  <text x="296" y="84">...</text>
                  <text x="528" y="84">.....</text>
                  <text x="40" y="100">Token</text>
                  <text x="416" y="100">Options</text>
                  <text x="464" y="100">(E)</text>
                  <text x="292" y="116">....</text>
                  <text x="532" y="116">....</text>
                  <text x="48" y="132">Options</text>
                  <text x="100" y="132">(IU)</text>
                  <text x="224" y="132">|</text>
                  <text x="404" y="132">OxFF</text>
                  <text x="8" y="148">.</text>
                  <text x="224" y="148">.</text>
                  <text x="44" y="164">OSCORE</text>
                  <text x="100" y="164">Option</text>
                  <text x="416" y="180">Payload</text>
                  <text x="36" y="196">0xFF</text>
                  <text x="60" y="244">Ciphertext</text>
                  <text x="424" y="292">Inner</text>
                  <text x="468" y="292">SCHC</text>
                  <text x="448" y="308">Compression</text>
                  <text x="72" y="356">Outer</text>
                  <text x="116" y="356">SCHC</text>
                  <text x="96" y="372">Compression</text>
                  <text x="428" y="404">RuleID</text>
                  <text x="448" y="436">Compression</text>
                  <text x="528" y="436">Residue</text>
                  <text x="64" y="468">RuleID'</text>
                  <text x="284" y="468">Encryption</text>
                  <text x="432" y="484">Payload</text>
                  <text x="80" y="500">Compression</text>
                  <text x="164" y="500">Residue'</text>
                  <text x="76" y="548">Ciphertext</text>
                </g>
              </svg><a href="#section-8.2-14.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-oscore-compression-diagram" class="selfRef">OSCORE Compression Diagram</a>
          </figcaption></figure>
</div>
<p id="section-8.2-15">The OSCORE message translates into a segmented process where SCHC compression is applied independently in two stages, each with its corresponding set of Rules, i.e., the Inner SCHC Rules and the Outer SCHC Rules. By doing so, compression is applied to all the fields of the original CoAP message.<a href="#section-8.2-15" class="pilcrow">¶</a></p>
<p id="section-8.2-16">As to the compression of the 0xFF payload marker, the same rationale described in <a href="#payload-marker" class="auto internal xref">Section 7</a> applies to both the Inner SCHC Compression and the Outer SCHC Compression. That is:<a href="#section-8.2-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-17.1">
            <p id="section-8.2-17.1.1">After the Inner SCHC Compression of a CoAP message including a payload, the payload marker <span class="bcp14">MUST NOT</span> be included in the input to the AEAD Encryption, which is composed of the Inner Compression RuleID, the Inner Compression Residue (if any), and the CoAP payload.<a href="#section-8.2-17.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-17.2">
            <p id="section-8.2-17.2.1">The Outer SCHC Compression takes as input the OSCORE-protected message, which always includes a payload (i.e., the OSCORE Ciphertext) preceded by the payload marker.<a href="#section-8.2-17.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-17.3">
            <p id="section-8.2-17.3.1">After the Outer SCHC Compression, the payload marker <span class="bcp14">MUST NOT</span> be included in the final compressed message, which is composed of the Outer Compression RuleID, the Outer Compression Residue (if any), and the OSCORE Ciphertext.<a href="#section-8.2-17.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-18">After having completed the Outer SCHC Decompression of an incoming message, the recipient endpoint <span class="bcp14">MUST</span> prepend the 0xFF payload marker to the OSCORE Ciphertext.<a href="#section-8.2-18" class="pilcrow">¶</a></p>
<p id="section-8.2-19">After having completed the Inner SCHC Decompression of an incoming message, the recipient endpoint <span class="bcp14">MUST</span> prepend the 0xFF payload marker to the CoAP payload, if any was present after the consumed Compression Residue.<a href="#section-8.2-19" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-oscore-compression">
<section id="section-8.3">
        <h3 id="name-example-oscore-compression">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-example-oscore-compression" class="section-name selfRef">Example OSCORE Compression</a>
        </h3>
<p id="section-8.3-1">This section provides an example with a GET request and a corresponding Content response, exchanged between a Device-based CoAP client and a cloud-based CoAP server. The example also describes a possible set of Rules for Inner SCHC Compression and Outer SCHC Compression. A dump of the results and a contrast between SCHC + OSCORE performance and SCHC + CoAP performance are also listed. This example shows an estimate of the cost of security with SCHC-OSCORE.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Our first CoAP message is the GET request in <a href="#fig-GET-temp" class="auto internal xref">Figure 9</a>.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<span id="name-coap-get-request"></span><div id="fig-GET-temp">
<figure id="figure-9">
          <div class="alignLeft art-text artwork" id="section-8.3-3.1">
<pre>
Original message:
=================
0x4101000182bb74656d7065726174757265

Header:
0x4101
01   Ver
  00   CON
    0001   TKL
        00000001   Request Code 1 "GET"

0x0001 = mid
0x82 = token

Options:

0xbb74656d7065726174757265
Option 11: Uri-Path
Value = temperature

Original message length: 17 bytes
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-coap-get-request" class="selfRef">CoAP GET Request</a>
          </figcaption></figure>
</div>
<p id="section-8.3-4">Its corresponding response is the Content response in <a href="#fig-CONTENT-temp" class="auto internal xref">Figure 10</a>.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<span id="name-coap-content-response"></span><div id="fig-CONTENT-temp">
<figure id="figure-10">
          <div class="alignLeft art-text artwork" id="section-8.3-5.1">
<pre>
Original message:
=================
0x6145000182ff32332043

Header:
0x6145
01   Ver
  10   ACK
    0001   TKL
        01000101 Successful Response Code 69 "2.05 Content"

0x0001 = mid
0x82 = token

0xFF  Payload marker

Payload:
0x32332043

Original message length: 10 bytes
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-coap-content-response" class="selfRef">CoAP Content Response</a>
          </figcaption></figure>
</div>
<p id="section-8.3-6">The SCHC Rules for the Inner Compression include all the fields present in a regular CoAP message. The methods described in <a href="#sec-coap-fields-compression" class="auto internal xref">Section 4</a> apply to these fields. Table 4 provides an example.<a href="#section-8.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-7">
<pre>
 +----------+
 | RuleID 0 |
 +----------+
</pre><a href="#section-8.3-7" class="pilcrow">¶</a>
</div>
<span id="name-inner-schc-rule"></span><div id="_table-Inner-Rules">
<table class="center" id="table-4">
          <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-inner-schc-rule" class="selfRef">Inner SCHC Rule</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[69, 132]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">C</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"temperature"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-8.3-9"><a href="#fig-Inner-Compression-GET" class="auto internal xref">Figure 11</a> shows the Plaintext obtained for the example GET request. The packet follows the process of Inner Compression and encryption until the payload. The Outer OSCORE message adds the result of the Inner process.<a href="#section-8.3-9" class="pilcrow">¶</a></p>
<span id="name-plaintext-compression-and-e"></span><div id="fig-Inner-Compression-GET">
<figure id="figure-11">
          <div id="section-8.3-10.1">
            <div class="alignCenter art-svg artwork" id="section-8.3-10.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="656" width="432" viewBox="0 0 432 656" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,208" fill="none" stroke="black"></path>
                <path d="M 48,528 L 48,640" fill="none" stroke="black"></path>
                <path d="M 120,288 L 120,432" fill="none" stroke="black"></path>
                <path d="M 232,216 L 232,280" fill="none" stroke="black"></path>
                <path d="M 232,440 L 232,520" fill="none" stroke="black"></path>
                <path d="M 336,288 L 336,432" fill="none" stroke="black"></path>
                <path d="M 424,32 L 424,208" fill="none" stroke="black"></path>
                <path d="M 424,528 L 424,640" fill="none" stroke="black"></path>
                <path d="M 8,32 L 424,32" fill="none" stroke="black"></path>
                <path d="M 8,208 L 424,208" fill="none" stroke="black"></path>
                <path d="M 120,288 L 336,288" fill="none" stroke="black"></path>
                <path d="M 120,432 L 336,432" fill="none" stroke="black"></path>
                <path d="M 48,528 L 424,528" fill="none" stroke="black"></path>
                <path d="M 48,640 L 424,640" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="240,520 228,514.4 228,525.6" fill="black" transform="rotate(90,232,520)"></polygon>
                <polygon class="arrowhead" points="240,280 228,274.4 228,285.6" fill="black" transform="rotate(90,232,280)"></polygon>
                <g class="text">
                  <text x="44" y="68">OSCORE</text>
                  <text x="112" y="68">Plaintext</text>
                  <text x="132" y="100">0x01bb74656d7065726174757265</text>
                  <text x="272" y="100">(13</text>
                  <text x="316" y="100">bytes)</text>
                  <text x="36" y="132">0x01</text>
                  <text x="88" y="132">Request</text>
                  <text x="140" y="132">Code</text>
                  <text x="176" y="132">GET</text>
                  <text x="156" y="164">bb74656d7065726174757265</text>
                  <text x="284" y="164">Option</text>
                  <text x="328" y="164">11:</text>
                  <text x="380" y="164">Uri-Path</text>
                  <text x="280" y="180">Value</text>
                  <text x="312" y="180">=</text>
                  <text x="368" y="180">temperature</text>
                  <text x="264" y="244">Inner</text>
                  <text x="308" y="244">SCHC</text>
                  <text x="376" y="244">Compression</text>
                  <text x="172" y="324">Compressed</text>
                  <text x="256" y="324">Plaintext</text>
                  <text x="148" y="356">0x00</text>
                  <text x="156" y="388">RuleID</text>
                  <text x="192" y="388">=</text>
                  <text x="220" y="388">0x00</text>
                  <text x="252" y="388">(1</text>
                  <text x="288" y="388">byte)</text>
                  <text x="144" y="404">(No</text>
                  <text x="208" y="404">Compression</text>
                  <text x="292" y="404">Residue)</text>
                  <text x="260" y="468">AEAD</text>
                  <text x="324" y="468">Encryption</text>
                  <text x="268" y="484">(piv</text>
                  <text x="296" y="484">=</text>
                  <text x="328" y="484">0x04)</text>
                  <text x="144" y="564">encrypted_plaintext</text>
                  <text x="232" y="564">=</text>
                  <text x="260" y="564">0xa2</text>
                  <text x="292" y="564">(1</text>
                  <text x="328" y="564">byte)</text>
                  <text x="80" y="580">tag</text>
                  <text x="104" y="580">=</text>
                  <text x="188" y="580">0xc54fe1b434297b62</text>
                  <text x="276" y="580">(8</text>
                  <text x="316" y="580">bytes)</text>
                  <text x="108" y="612">ciphertext</text>
                  <text x="160" y="612">=</text>
                  <text x="252" y="612">0xa2c54fe1b434297b62</text>
                  <text x="348" y="612">(9</text>
                  <text x="388" y="612">bytes)</text>
                </g>
              </svg><a href="#section-8.3-10.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-plaintext-compression-and-e" class="selfRef">Plaintext Compression and Encryption for GET Request</a>
          </figcaption></figure>
</div>
<p id="section-8.3-11">In this case, the original message has no payload, and its resulting Plaintext is compressed up to only 1 byte (the size of the RuleID). The AEAD algorithm preserves this length in its first output and yields a fixed-size tag. SCHC cannot compress the tag, and the OSCORE message must include it without compression. The use of integrity protection translates into an overhead on the total message length, thus limiting the amount of compression that can be achieved and contributing to the cost of adding security to the exchange.<a href="#section-8.3-11" class="pilcrow">¶</a></p>
<p id="section-8.3-12"><a href="#fig-Inner-Compression-CONTENT" class="auto internal xref">Figure 12</a> shows the process for the example Content response. The Compression Residue is 1 bit long. Note that since SCHC adds padding after the payload, this misalignment causes the hexadecimal code from the payload to differ from the original, even if SCHC cannot compress the tag. The overhead for the tag bytes limits SCHC's performance but adds security to the exchange.<a href="#section-8.3-12" class="pilcrow">¶</a></p>
<span id="name-plaintext-compression-and-en"></span><div id="fig-Inner-Compression-CONTENT">
<figure id="figure-12">
          <div id="section-8.3-13.1">
            <div class="alignCenter art-svg artwork" id="section-8.3-13.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="720" width="488" viewBox="0 0 488 720" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,224" fill="none" stroke="black"></path>
                <path d="M 16,304 L 16,496" fill="none" stroke="black"></path>
                <path d="M 16,592 L 16,704" fill="none" stroke="black"></path>
                <path d="M 232,232 L 232,296" fill="none" stroke="black"></path>
                <path d="M 232,504 L 232,584" fill="none" stroke="black"></path>
                <path d="M 408,32 L 408,224" fill="none" stroke="black"></path>
                <path d="M 408,304 L 408,496" fill="none" stroke="black"></path>
                <path d="M 480,592 L 480,704" fill="none" stroke="black"></path>
                <path d="M 8,32 L 408,32" fill="none" stroke="black"></path>
                <path d="M 8,224 L 408,224" fill="none" stroke="black"></path>
                <path d="M 16,304 L 408,304" fill="none" stroke="black"></path>
                <path d="M 16,496 L 408,496" fill="none" stroke="black"></path>
                <path d="M 16,592 L 480,592" fill="none" stroke="black"></path>
                <path d="M 16,704 L 480,704" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="240,584 228,578.4 228,589.6" fill="black" transform="rotate(90,232,584)"></polygon>
                <polygon class="arrowhead" points="240,296 228,290.4 228,301.6" fill="black" transform="rotate(90,232,296)"></polygon>
                <g class="text">
                  <text x="44" y="68">OSCORE</text>
                  <text x="112" y="68">Plaintext</text>
                  <text x="76" y="100">0x45ff32332043</text>
                  <text x="156" y="100">(6</text>
                  <text x="196" y="100">bytes)</text>
                  <text x="36" y="132">0x45</text>
                  <text x="100" y="132">Successful</text>
                  <text x="180" y="132">Response</text>
                  <text x="236" y="132">Code</text>
                  <text x="268" y="132">69</text>
                  <text x="304" y="132">"2.05</text>
                  <text x="364" y="132">Content"</text>
                  <text x="60" y="164">ff</text>
                  <text x="104" y="164">Payload</text>
                  <text x="164" y="164">marker</text>
                  <text x="100" y="196">32332043</text>
                  <text x="168" y="196">Payload</text>
                  <text x="264" y="260">Inner</text>
                  <text x="308" y="260">SCHC</text>
                  <text x="376" y="260">Compression</text>
                  <text x="68" y="340">Compressed</text>
                  <text x="152" y="340">Plaintext</text>
                  <text x="84" y="372">0x001919902180</text>
                  <text x="156" y="372">(6</text>
                  <text x="196" y="372">bytes)</text>
                  <text x="52" y="404">00</text>
                  <text x="92" y="404">RuleID</text>
                  <text x="48" y="436">0b0</text>
                  <text x="76" y="436">(1</text>
                  <text x="104" y="436">bit</text>
                  <text x="176" y="436">match-mapping</text>
                  <text x="280" y="436">Compression</text>
                  <text x="364" y="436">Residue)</text>
                  <text x="116" y="452">0x32332043</text>
                  <text x="172" y="452">&gt;&gt;</text>
                  <text x="192" y="452">1</text>
                  <text x="236" y="452">(shifted</text>
                  <text x="308" y="452">payload)</text>
                  <text x="248" y="468">0b0000000</text>
                  <text x="320" y="468">Padding</text>
                  <text x="260" y="532">AEAD</text>
                  <text x="324" y="532">Encryption</text>
                  <text x="268" y="548">(piv</text>
                  <text x="296" y="548">=</text>
                  <text x="328" y="548">0x04)</text>
                  <text x="112" y="628">encrypted_plaintext</text>
                  <text x="200" y="628">=</text>
                  <text x="268" y="628">0x10c6d7c26cc1</text>
                  <text x="340" y="628">(6</text>
                  <text x="380" y="628">bytes)</text>
                  <text x="48" y="644">tag</text>
                  <text x="72" y="644">=</text>
                  <text x="156" y="644">0xe9aef3f2461e0c29</text>
                  <text x="244" y="644">(8</text>
                  <text x="284" y="644">bytes)</text>
                  <text x="76" y="676">ciphertext</text>
                  <text x="128" y="676">=</text>
                  <text x="260" y="676">0x10c6d7c26cc1e9aef3f2461e0c29</text>
                  <text x="400" y="676">(14</text>
                  <text x="444" y="676">bytes)</text>
                </g>
              </svg><a href="#section-8.3-13.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-plaintext-compression-and-en" class="selfRef">Plaintext Compression and Encryption for Content Response</a>
          </figcaption></figure>
</div>
<p id="section-8.3-14">The Outer SCHC Rule shown in <a href="#_table-Outer-Rules" class="auto internal xref">Table 5</a> is used, also to process the OSCORE Option fields. <a href="#fig-Protected-Compressed-GET" class="auto internal xref">Figure 13</a> and <a href="#fig-Protected-Compressed-CONTENT" class="auto internal xref">Figure 14</a> show a dump of the OSCORE messages generated from the example messages, also including the Inner Compressed ciphertext in the payload. These are the messages that have to be compressed via the Outer SCHC Compression scheme.<a href="#section-8.3-14" class="pilcrow">¶</a></p>
<p id="section-8.3-15"><a href="#_table-Outer-Rules" class="auto internal xref">Table 5</a> shows a possible set of Outer Rule items to compress the Outer header.<a href="#section-8.3-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-16">
<pre>
+----------+
| RuleID 1 |
+----------+
</pre><a href="#section-8.3-16" class="pilcrow">¶</a>
</div>
<span id="name-outer-schc-rule"></span><div id="_table-Outer-Rules">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-outer-schc-rule" class="selfRef">Outer SCHC Rule</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">68</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0000</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x80</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x09</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(4)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">PPPP</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x636c69 <br> 656e70</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(44)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">KKKK</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kidctx</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_x</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_nonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.x.m</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_y</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_oldnonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.y.w</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<span id="name-protected-and-inner-schc-co"></span><div id="fig-Protected-Compressed-GET">
<figure id="figure-13">
          <div class="alignCenter art-text artwork" id="section-8.3-18.1">
<pre>
Protected message:
==================
0x4102000182980904636c69656e74ffa2c54fe1b434297b62
(24 bytes)

Header:
0x4102
01   Ver
  00   CON
    0001   TKL
        00000010   Request Code 2 "POST"

0x0001 = mid
0x82 = token

Options:

0x98 0904636c69656e74 (9 bytes)
Option 9: OSCORE
Value = 0x0904636c69656e74
          09 = 000 0 1 001 flag byte
                   h k  n
            04 piv
              636c69656e74 kid

0xFF  Payload marker

Payload:
0xa2c54fe1b434297b62 (9 bytes)
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-protected-and-inner-schc-co" class="selfRef">Protected and Inner SCHC Compressed GET Request</a>
          </figcaption></figure>
</div>
<span id="name-protected-and-inner-schc-com"></span><div id="fig-Protected-Compressed-CONTENT">
<figure id="figure-14">
          <div class="alignCenter art-text artwork" id="section-8.3-19.1">
<pre>
Protected message:
==================
0x614400018290ff10c6d7c26cc1e9aef3f2461e0c29
(21 bytes)

Header:
0x6144
01   Ver
  10   ACK
    0001   TKL
        01000100   Successful Response Code 68 "2.04 Changed"

0x0001 = mid
0x82 = token

Options:

0x90 (1 byte)
Option 9: OSCORE
Value = b''

0xFF  Payload marker

Payload:
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-protected-and-inner-schc-com" class="selfRef">Protected and Inner SCHC Compressed Content Response</a>
          </figcaption></figure>
</div>
<p id="section-8.3-20">For the flag bits, some SCHC compression methods are useful, depending on the application. The most straightforward alternative is to provide a fixed value for the flags, combining an "equal" MO and a "not-sent" CDA. This SCHC description saves most bits but could prevent flexibility. Otherwise, SCHC could use a "match-mapping" MO to choose from several configurations for the exchange. If not, the SCHC description may use an MSB MO to mask off the three hard-coded most significant bits.<a href="#section-8.3-20" class="pilcrow">¶</a></p>
<p id="section-8.3-21">Note that fixing a flag bit will limit the possible OSCORE options that can be used in the exchange, since the value of the flag bits plays a role in determining a specific OSCORE option.<a href="#section-8.3-21" class="pilcrow">¶</a></p>
<p id="section-8.3-22">The piv field lends itself to having some bits masked off with an MSB MO and an LSB CDA. This SCHC description could be useful in applications where the message transmission frequency is low, such as with LPWAN technologies. Note that compressing the piv field may reduce the maximum number of sequence numbers that can be used in an exchange. Once the sequence number exceeds the maximum value, the OSCORE keys need to be re-established.<a href="#section-8.3-22" class="pilcrow">¶</a></p>
<p id="section-8.3-23">The size, s, that is included in the OSCORE_kidctx field <span class="bcp14">MAY</span> be masked off with an LSB CDA. The rest of the OSCORE_kidctx field could have additional bits masked off, or the whole field could be fixed in accordance with an "equal" MO and a "not-sent" CDA. The same holds for the OSCORE_kid field.<a href="#section-8.3-23" class="pilcrow">¶</a></p>
<p id="section-8.3-24">The Outer Rule of <a href="#_table-Outer-Rules" class="auto internal xref">Table 5</a> is applied to the example GET request and Content response. <a href="#fig-Compressed-GET" class="auto internal xref">Figure 15</a> and <a href="#fig-Compressed-CONTENT" class="auto internal xref">Figure 16</a> show the resulting messages.<a href="#section-8.3-24" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-compressed-get-"></span><div id="fig-Compressed-GET">
<figure id="figure-15">
          <div class="alignLeft art-text artwork" id="section-8.3-25.1">
<pre>
Compressed message:
==================
0x01148889458a9fc3686852f6c4 (13 bytes)
0x01 RuleID
    148889 compression residue
          458a9fc3686852f6c4 padded payload

Compression Residue:
0b 0001 010
    mid tkn

   0100 0100
         piv (residue size and residue)

   0100 0100
         kid (residue size and residue)

   (23 bits -&gt; 3 bytes with padding)

Payload
0xa2c54fe1b434297b62 (9 bytes)

Compressed message length: 13 bytes
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a>:
<a href="#name-schc-oscore-compressed-get-" class="selfRef">SCHC-OSCORE Compressed GET Request</a>
          </figcaption></figure>
</div>
<span id="name-schc-oscore-compressed-cont"></span><div id="fig-Compressed-CONTENT">
<figure id="figure-16">
          <div class="alignLeft art-text artwork" id="section-8.3-26.1">
<pre>
Compressed message:
==================
0x0114218daf84d983d35de7e48c3c1852 (16 bytes)
0x01 RuleID
    14 Compression Residue
      218daf84d983d35de7e48c3c1852 Padded payload

Compression Residue:
0b0001 010 (7 bits -&gt; 1 byte with padding)
   mid tkn

Payload
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a>:
<a href="#name-schc-oscore-compressed-cont" class="selfRef">SCHC-OSCORE Compressed Content Response</a>
          </figcaption></figure>
</div>
<p id="section-8.3-27">In contrast, the following compares these results with what would be obtained by SCHC compressing the original CoAP messages without protecting them with OSCORE, according to the SCHC Rule in <a href="#_table-NoOsc-Rules" class="auto internal xref">Table 6</a>.<a href="#section-8.3-27" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-28">
<pre>
+----------+
| RuleID 2 |
+----------+
</pre><a href="#section-8.3-28" class="pilcrow">¶</a>
</div>
<span id="name-schc-coap-rule-no-oscore"></span><div id="_table-NoOsc-Rules">
<table class="center" id="table-6">
          <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-schc-coap-rule-no-oscore" class="selfRef">SCHC-CoAP Rule (No OSCORE)</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[69, 132]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">C</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0000</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x80</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"temperature"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-8.3-30">The Rule in <a href="#_table-NoOsc-Rules" class="auto internal xref">Table 6</a> yields the SCHC compression results shown in <a href="#fig-GET-temp-no-oscore" class="auto internal xref">Figure 17</a> for the request and in <a href="#fig-CONTENT-temp-no-oscore" class="auto internal xref">Figure 18</a> for the response.<a href="#section-8.3-30" class="pilcrow">¶</a></p>
<span id="name-coap-get-compressed-without"></span><div id="fig-GET-temp-no-oscore">
<figure id="figure-17">
          <div class="alignLeft art-text artwork" id="section-8.3-31.1">
<pre>
Compressed message:
==================
0x0214
0x02 = RuleID

Compression Residue:
0b00010100 (1 byte)

Compressed message length: 2 bytes
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a>:
<a href="#name-coap-get-compressed-without" class="selfRef">CoAP GET Compressed without OSCORE</a>
          </figcaption></figure>
</div>
<span id="name-coap-content-compressed-wit"></span><div id="fig-CONTENT-temp-no-oscore">
<figure id="figure-18">
          <div class="alignLeft art-text artwork" id="section-8.3-32.1">
<pre>
Compressed message:
==================
0x020a32332043
0x02 = RuleID

Compression Residue:
0b00001010 (1 byte)

Payload
0x32332043

Compressed message length: 6 bytes
</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a>:
<a href="#name-coap-content-compressed-wit" class="selfRef">CoAP Content Compressed without OSCORE</a>
          </figcaption></figure>
</div>
<p id="section-8.3-33">As can be seen, the difference between applying SCHC + OSCORE as compared to regular SCHC + CoAP is about 10 bytes.<a href="#section-8.3-33" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="compression-with-proxies">
<section id="section-9">
      <h2 id="name-coap-header-compression-wit">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-coap-header-compression-wit" class="section-name selfRef">CoAP Header Compression with Proxies</a>
      </h2>
<p id="section-9-1">This section defines how SCHC Compression/Decompression is performed when CoAP proxies are deployed. The following refers to the origin client and origin server as application endpoints.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Note that SCHC Compression/Decompression of CoAP headers is not necessarily used between each pair of hops in the communication chain. For example, if a proxy is deployed between an origin client and an origin server, SCHC might be used on the communication leg between the origin client and the proxy, but not on the communication leg between the proxy and the origin server.<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="compression-with-proxies-without-oscore">
<section id="section-9.1">
        <h3 id="name-without-end-to-end-security">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-without-end-to-end-security" class="section-name selfRef">Without End-to-End Security</a>
        </h3>
<p id="section-9.1-1">In case OSCORE is not used end-to-end between client and server, the SCHC processing occurs hop-by-hop, by relying on SCHC Rules that are consistently shared between two adjacent hops.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">In particular, SCHC is used as defined below.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-3.1">
            <p id="section-9.1-3.1.1">The sender application endpoint compresses the CoAP message, by using the SCHC Rules that it shares with the next hop towards the recipient application endpoint. The resulting, compressed message is sent to the next hop towards the recipient application endpoint.<a href="#section-9.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-3.2">
            <p id="section-9.1-3.2.1">Each proxy decompresses the incoming compressed message, by using the SCHC Rules that it shares with the (previous hop towards the) sender application endpoint.<a href="#section-9.1-3.2.1" class="pilcrow">¶</a></p>
<p id="section-9.1-3.2.2">
Then, the proxy compresses the CoAP message to be forwarded, by using the SCHC Rules that it shares with the (next hop towards the) recipient application endpoint.<a href="#section-9.1-3.2.2" class="pilcrow">¶</a></p>
<p id="section-9.1-3.2.3">
The resulting, compressed message is sent to the (next hop towards the) recipient application endpoint.<a href="#section-9.1-3.2.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-3.3">
            <p id="section-9.1-3.3.1">The recipient application endpoint decompresses the incoming compressed message, by using the SCHC Rules that it shares with the previous hop towards the sender application endpoint.<a href="#section-9.1-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="compression-with-proxies-with-oscore">
<section id="section-9.2">
        <h3 id="name-with-end-to-end-security">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-with-end-to-end-security" class="section-name selfRef">With End-to-End Security</a>
        </h3>
<p id="section-9.2-1">In case OSCORE is used end-to-end between client and server (see <a href="#ssec-examples-oscore" class="auto internal xref">Section 8.2</a>), the following applies.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">The SCHC processing occurs end-to-end as to the Inner SCHC Compression/Decompression, by relying on Inner SCHC Rules that are consistently shared between the two application endpoints acting as OSCORE endpoints and sharing the used OSCORE Security Context.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">Instead, the SCHC processing occurs hop-by-hop as to the Outer SCHC Compression/Decompression, by relying on Outer SCHC Rules that are consistently shared between two adjacent hops.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">In particular, SCHC is used as defined below.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2-5.1">
            <p id="section-9.2-5.1.1">The sender application endpoint performs the Inner SCHC Compression on the original CoAP message, by using the Inner SCHC Rules that it shares with the recipient application endpoint.<a href="#section-9.2-5.1.1" class="pilcrow">¶</a></p>
<p id="section-9.2-5.1.2">
Following the AEAD Encryption of the compressed input obtained from the previous step, the sender application endpoint performs the Outer SCHC Compression on the resulting OSCORE-protected message, by using the Outer SCHC Rules that it shares with the next hop towards the recipient application endpoint.<a href="#section-9.2-5.1.2" class="pilcrow">¶</a></p>
<p id="section-9.2-5.1.3">
The resulting, compressed message is sent to the next hop towards the recipient application endpoint.<a href="#section-9.2-5.1.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-5.2">
            <p id="section-9.2-5.2.1">Each proxy performs the Outer SCHC Decompression on the incoming compressed message, by using the SCHC Rules that it shares with the (previous hop towards the) sender application endpoint.<a href="#section-9.2-5.2.1" class="pilcrow">¶</a></p>
<p id="section-9.2-5.2.2">
Then, the proxy performs the Outer SCHC Compression of the OSCORE-protected message to be forwarded, by using the SCHC Rules that it shares with the (next hop towards the) recipient application endpoint.<a href="#section-9.2-5.2.2" class="pilcrow">¶</a></p>
<p id="section-9.2-5.2.3">
The resulting, compressed message is sent to the (next hop towards the) recipient application endpoint.<a href="#section-9.2-5.2.3" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.2-5.3">
            <p id="section-9.2-5.3.1">The recipient application endpoint performs the Outer SCHC Decompression on the incoming compressed message, by using the Outer SCHC Rules that it shares with the previous hop towards the sender application endpoint.<a href="#section-9.2-5.3.1" class="pilcrow">¶</a></p>
<p id="section-9.2-5.3.2">
Then, the recipient application endpoint performs the AEAD Decryption of the OSCORE-protected message obtained from the previous step.<a href="#section-9.2-5.3.2" class="pilcrow">¶</a></p>
<p id="section-9.2-5.3.3">
Finally, the recipient application endpoint performs the Inner SCHC Decompression on the compressed input obtained from the previous step, by using the Inner SCHC Rules that it shares with the sender application endpoint. The result is the original CoAP message produced by the sender application endpoint.<a href="#section-9.2-5.3.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-10">
      <h2 id="name-examples-of-coap-header-comp">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-examples-of-coap-header-comp" class="section-name selfRef">Examples of CoAP Header Compression with Proxies</a>
      </h2>
<p id="section-10-1">This section provides examples of SCHC Compression/Decompression in the presence of a CoAP proxy.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">The presented examples refer to the same deployment considered in <a href="#sec-applicability-to-coap" class="auto internal xref">Section 2</a>, including a Device communicating over LPWAN with a Network Gateway (NGW), which in turn communicates with an Application Server over the Internet. The Application Server and the Device exchange CoAP messages through the NGW.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">The following also applies in the presented examples.<a href="#section-10-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-4.1">
          <p id="section-10-4.1.1">CoAP request messages are sent only by the Device as targeting the Application Server (uplink traffic), which replies to the Device with corresponding CoAP response messages (downlink traffic). That is, the Device acts as CoAP client, while the Application Server acts as CoAP server.<a href="#section-10-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-4.2">
          <p id="section-10-4.2.1">A CoAP proxy is co-located on the Network Gateway (NGW) deployed between the Application Server and the Device.<a href="#section-10-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-4.3">
          <p id="section-10-4.3.1">SCHC is used also on the communication leg between the Application Server and the proxy.<a href="#section-10-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-10-5">Like in <a href="#sec-applicability-to-coap" class="auto internal xref">Section 2</a>, the presented examples focus on SCHC Compression/Decompression of CoAP headers, i.e., irrespective of possible SCHC Compression/Decompression applied to further protocol headers.<a href="#section-10-5" class="pilcrow">¶</a></p>
<p id="section-10-6">The example in <a href="#examples-without-oscore" class="auto internal xref">Section 10.1</a> considers an exchange of two unprotected messages, while the example in <a href="#examples-with-oscore" class="auto internal xref">Section 10.2</a> considers an exchange of two messages protected end-to-end with OSCORE. In the examples, the character | denotes bit concatenation.<a href="#section-10-6" class="pilcrow">¶</a></p>
<p id="section-10-7"><a href="#fig-example-req" class="auto internal xref">Figure 19</a> and <a href="#fig-example-resp" class="auto internal xref">Figure 20</a> show the two CoAP messages exchanged between the Device and the Application Server, via the proxy. The figures show the two messages as originally generated by the application at the two origin endpoints, i.e., before they are possibly protected end-to-end with OSCORE as considered by the example in <a href="#examples-with-oscore" class="auto internal xref">Section 10.2</a>.<a href="#section-10-7" class="pilcrow">¶</a></p>
<p id="section-10-8">In particular, note that:<a href="#section-10-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-9.1">
          <p id="section-10-9.1.1">On the communication leg between the Device and the proxy, the CoAP Message ID has value 0x0001 and the CoAP Token has value 0x82.<a href="#section-10-9.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-9.2">
          <p id="section-10-9.2.1">On the communication leg between the proxy and the Application Server, the CoAP Message ID has value 0x0004 and the CoAP Token has value 0x75.<a href="#section-10-9.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<span id="name-coap-get-request-2"></span><div id="fig-example-req">
<figure id="figure-19">
        <div class="alignLeft art-text artwork" id="section-10-10.1">
<pre>
Original message:
=================
0x41010001823b6578616d706c652e636f6d
  8b74656d7065726174757265d40f636f6170

Header:
0x4101
01   Ver
  00   CON
    0001   TKL
        00000001   Request Code 1 "GET"

0x0001 = mid
0x82 = token

Options:

0x3b6578616d706c652e636f6d
Option 3: Uri-Host
Value = example.com

0x8b74656d7065726174757265
Option 11: Uri-Path
Value = temperature

0xd40f636f6170
Option 39: Proxy-Scheme
Value = coap

Original message length: 35 bytes

</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a>:
<a href="#name-coap-get-request-2" class="selfRef">CoAP GET Request</a>
        </figcaption></figure>
</div>
<span id="name-coap-content-response-2"></span><div id="fig-example-resp">
<figure id="figure-20">
        <div class="alignLeft art-text artwork" id="section-10-11.1">
<pre>
Original message:
=================
0x6145000475ff32332043

Header:
0x6145
01   Ver
  10   ACK
    0001   TKL
        01000101 Successful Response Code 69 "2.05 Content"

0x0004 = mid
0x75 = token


0xFF Payload marker

Payload:
0x32332043

Original message length: 10 bytes

</pre>
</div>
<figcaption><a href="#figure-20" class="selfRef">Figure 20</a>:
<a href="#name-coap-content-response-2" class="selfRef">CoAP Content Response</a>
        </figcaption></figure>
</div>
<div id="examples-without-oscore">
<section id="section-10.1">
        <h3 id="name-without-end-to-end-security-2">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-without-end-to-end-security-2" class="section-name selfRef">Without End-to-End Security</a>
        </h3>
<p id="section-10.1-1">In case OSCORE is not used end-to-end between the Device and the Application Server, the following SCHC Rules are shared between the different entities. Based on those Rules, the SCHC Compression/Decompression is performed as per <a href="#compression-with-proxies-without-oscore" class="auto internal xref">Section 9.1</a>.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">The Device and the proxy share the SCHC Rule shown in <a href="#fig-rules-device-proxy" class="auto internal xref">Table 7</a>, with RuleID 0.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.1-3">
<pre>
+----------+
| RuleID 0 |
+----------+
</pre><a href="#section-10.1-3" class="pilcrow">¶</a>
</div>
<span id="name-schc-rule-between-the-devic"></span><div id="fig-rules-device-proxy">
<table class="center" id="table-7">
          <caption>
<a href="#table-7" class="selfRef">Table 7</a>:
<a href="#name-schc-rule-between-the-devic" class="selfRef">SCHC Rule between the Device and the Proxy</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[0, 2]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">T</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">[1, 2, <br> 3, 4]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[65, 68, <br> 69, 132]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x80</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Host</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"temperature"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Proxy-Scheme</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"coap"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-10.1-5">Instead, the proxy and the Application Server share the SCHC Rule shown in <a href="#fig-rules-proxy-server" class="auto internal xref">Table 8</a>, with RuleID 1.<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.1-6">
<pre>
+----------+
| RuleID 1 |
+----------+
</pre><a href="#section-10.1-6" class="pilcrow">¶</a>
</div>
<span id="name-schc-rule-between-the-proxy"></span><div id="fig-rules-proxy-server">
<table class="center" id="table-8">
          <caption>
<a href="#table-8" class="selfRef">Table 8</a>:
<a href="#name-schc-rule-between-the-proxy" class="selfRef">SCHC Rule between the Proxy and the Application Server</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[0, 2]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">T</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">[1, 2, <br> 3, 4]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[65, 68, <br> 69, 132]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x70</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Host</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"temperature"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-10.1-8">First, the Device applies the Rule in <a href="#fig-rules-device-proxy" class="auto internal xref">Table 7</a> shared with the proxy to the CoAP request in <a href="#fig-example-req" class="auto internal xref">Figure 19</a>. The result is the compressed CoAP request in <a href="#fig-example-req-to-proxy" class="auto internal xref">Figure 21</a>, which the Device sends to the proxy.<a href="#section-10.1-8" class="pilcrow">¶</a></p>
<span id="name-coap-get-request-compressed"></span><div id="fig-example-req-to-proxy">
<figure id="figure-21">
          <div class="alignLeft art-text artwork" id="section-10.1-9.1">
<pre>
Compressed message:
=================
0x00055b2bc30b6b836329731b7b68 (14 bytes)
0x00 RuleID
    055b2bc30b6b836329731b7b68 compression residue
                                and padded payload

Compression Residue (101 bits -&gt; 13 bytes with padding)
0b   00 0001 010      1011  |  0x6578616d706c652e636f6d
   code  mid tkn  Uri-Host (residue size and residue)

Compressed message length: 14 bytes

</pre>
</div>
<figcaption><a href="#figure-21" class="selfRef">Figure 21</a>:
<a href="#name-coap-get-request-compressed" class="selfRef">CoAP GET Request Compressed for the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-10">Upon receiving the message in <a href="#fig-example-req-to-proxy" class="auto internal xref">Figure 21</a>, the proxy decompresses it with the Rule in <a href="#fig-rules-device-proxy" class="auto internal xref">Table 7</a> shared with the Device, and obtains the same CoAP request in <a href="#fig-example-req" class="auto internal xref">Figure 19</a>.<a href="#section-10.1-10" class="pilcrow">¶</a></p>
<p id="section-10.1-11">After that, the proxy removes the Proxy-Scheme Option from the decompressed CoAP request. Also, the proxy replaces the values of the CoAP Message ID and of the CoAP Token to 0x0004 and 0x75, respectively. The result is the CoAP request shown in <a href="#fig-example-req-from-proxy" class="auto internal xref">Figure 22</a>.<a href="#section-10.1-11" class="pilcrow">¶</a></p>
<span id="name-coap-get-request-to-be-comp"></span><div id="fig-example-req-from-proxy">
<figure id="figure-22">
          <div class="alignLeft art-text artwork" id="section-10.1-12.1">
<pre>
Message to forward:
=================
0x41010004753b6578616d706c652e636f6d
  8b74656d7065726174757265

Header:
0x4101
01   Ver
  00   CON
    0001   TKL
        00000001   Request Code 1 "GET"

0x0004 = mid
0x75 = token

Options:

0x3b6578616d706c652e636f6d
Option 3: Uri-Host
Value = example.com

0x8b74656d7065726174757265
Option 11: Uri-Path
Value = temperature

Original message length: 29 bytes

</pre>
</div>
<figcaption><a href="#figure-22" class="selfRef">Figure 22</a>:
<a href="#name-coap-get-request-to-be-comp" class="selfRef">CoAP GET Request to be Compressed by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-13">Then, the proxy applies the Rule in <a href="#fig-rules-proxy-server" class="auto internal xref">Table 8</a> shared with the Application Server to the CoAP request in <a href="#fig-example-req-from-proxy" class="auto internal xref">Figure 22</a>.<a href="#section-10.1-13" class="pilcrow">¶</a></p>
<p id="section-10.1-14">The result is the compressed CoAP request in <a href="#fig-example-req-from-proxy-compressed" class="auto internal xref">Figure 23</a>, which the proxy forwards to the Application Server.<a href="#section-10.1-14" class="pilcrow">¶</a></p>
<span id="name-coap-get-request-forwarded-"></span><div id="fig-example-req-from-proxy-compressed">
<figure id="figure-23">
          <div class="alignLeft art-text artwork" id="section-10.1-15.1">
<pre>
Compressed message to forward:
=================
0x0112db2bc30b6b836329731b7b68 (14 bytes)
0x01 RuleID
    12db2bc30b6b836329731b7b68 compression residue
                                and padded payload


Compression Residue (101 bits -&gt; 13 bytes with padding)
0b   00 0100 101      1011  |  0x6578616d706c652e636f6d
   code  mid tkn  Uri-Host (residue size and residue)

Compressed message length: 14 bytes

</pre>
</div>
<figcaption><a href="#figure-23" class="selfRef">Figure 23</a>:
<a href="#name-coap-get-request-forwarded-" class="selfRef">CoAP GET Request Forwarded by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-16">Upon receiving the message in <a href="#fig-example-req-from-proxy-compressed" class="auto internal xref">Figure 23</a>, the Application Server decompresses it using the Rule in <a href="#fig-rules-proxy-server" class="auto internal xref">Table 8</a> shared with the proxy. The result is the same CoAP request in <a href="#fig-example-req-from-proxy" class="auto internal xref">Figure 22</a>, which the Application Server delivers to the application.<a href="#section-10.1-16" class="pilcrow">¶</a></p>
<p id="section-10.1-17">After that, the Application Server produces the CoAP response in <a href="#fig-example-resp" class="auto internal xref">Figure 20</a>, and compresses it using the Rule in <a href="#fig-rules-proxy-server" class="auto internal xref">Table 8</a> shared with the proxy. The result is the compressed CoAP response shown in <a href="#fig-example-resp-to-proxy" class="auto internal xref">Figure 24</a>, which the Application Server sends to the proxy.<a href="#section-10.1-17" class="pilcrow">¶</a></p>
<span id="name-coap-content-response-compr"></span><div id="fig-example-resp-to-proxy">
<figure id="figure-24">
          <div class="alignLeft art-text artwork" id="section-10.1-18.1">
<pre>
Compressed message:
=================
0x01c94c8cc810c0 (7 bytes)
0x01 RuleID
    c94c8cc810c0 compression residue
                 and padded payload


Compression Residue (10 bits -&gt; 2 bytes with padding)
0b    1   10 0100 101
   type code  mid tkn

Payload
0x32332043 (4 bytes)

Compressed message length: 7 bytes

</pre>
</div>
<figcaption><a href="#figure-24" class="selfRef">Figure 24</a>:
<a href="#name-coap-content-response-compr" class="selfRef">CoAP Content Response Compressed for the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-19">Upon receiving the message in <a href="#fig-example-resp-to-proxy" class="auto internal xref">Figure 24</a>, the proxy decompresses it using the Rule in <a href="#fig-rules-proxy-server" class="auto internal xref">Table 8</a> shared with the Application Server. The result is the same CoAP response in <a href="#fig-example-resp" class="auto internal xref">Figure 20</a>.<a href="#section-10.1-19" class="pilcrow">¶</a></p>
<p id="section-10.1-20">Then, the proxy replaces the values of the CoAP Message ID and of the CoAP Token to 0x0001 and 0x82, respectively. The result is the CoAP response shown in <a href="#fig-example-resp-from-proxy" class="auto internal xref">Figure 25</a>.<a href="#section-10.1-20" class="pilcrow">¶</a></p>
<span id="name-coap-content-response-to-be"></span><div id="fig-example-resp-from-proxy">
<figure id="figure-25">
          <div class="alignLeft art-text artwork" id="section-10.1-21.1">
<pre>
Message to forward:
=================
0x6145000182ff32332043

Header:
0x6145
01   Ver
  10   ACK
    0001   TKL
        01000101 Successful Response Code 69 "2.05 Content"

0x0001 = mid
0x82 = token


0xFF Payload marker

Payload:
0x32332043

Original message length: 10 bytes

</pre>
</div>
<figcaption><a href="#figure-25" class="selfRef">Figure 25</a>:
<a href="#name-coap-content-response-to-be" class="selfRef">CoAP Content Response to be Compressed by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-22">Then, the proxy compresses the CoAP response in <a href="#fig-example-resp-from-proxy" class="auto internal xref">Figure 25</a> with the Rule in <a href="#fig-rules-device-proxy" class="auto internal xref">Table 7</a> shared with the Device. The result is the compressed CoAP response shown in <a href="#fig-example-resp-from-proxy-compressed" class="auto internal xref">Figure 26</a>, which the proxy forwards to the Device.<a href="#section-10.1-22" class="pilcrow">¶</a></p>
<span id="name-coap-content-response-forwa"></span><div id="fig-example-resp-from-proxy-compressed">
<figure id="figure-26">
          <div class="alignLeft art-text artwork" id="section-10.1-23.1">
<pre>
Compressed message:
=================
0x00c28c8cc810c0 (7 bytes)
0x00 RuleID
    c28c8cc810c0 compression residue
                 and padded payload


Compression Residue (10 bits -&gt; 2 bytes with padding)
0b    1   10 0001 010
   type code  mid tkn

Payload
0x32332043 (4 bytes)

Compressed message length: 7 bytes

</pre>
</div>
<figcaption><a href="#figure-26" class="selfRef">Figure 26</a>:
<a href="#name-coap-content-response-forwa" class="selfRef">CoAP Content Response Forwarded by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.1-24">Upon receiving the message in <a href="#fig-example-resp-from-proxy-compressed" class="auto internal xref">Figure 26</a>, the Device decompresses it using the Rule in <a href="#fig-rules-device-proxy" class="auto internal xref">Table 7</a> shared with the proxy. The result is the same CoAP request in <a href="#fig-example-resp-from-proxy" class="auto internal xref">Figure 25</a>, which the Device delivers to the application.<a href="#section-10.1-24" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples-with-oscore">
<section id="section-10.2">
        <h3 id="name-with-end-to-end-security-2">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-with-end-to-end-security-2" class="section-name selfRef">With End-to-End Security</a>
        </h3>
<p id="section-10.2-1">In case OSCORE is used end-to-end between the Device and the Application Server, the following SCHC Rules are shared between the different entities. Based on those Rules, the SCHC Compression/Decompression is performed as per <a href="#compression-with-proxies-with-oscore" class="auto internal xref">Section 9.2</a>.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">The Device and the Application Server share the SCHC Rule shown in <a href="#fig-rules-oscore-device-server" class="auto internal xref">Table 9</a>, with RuleID 2. The Device and the Application Server use this Rule to perform the Inner SCHC Compression/Decompression end-to-end.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-3">
<pre>
+----------+
| RuleID 2 |
+----------+
</pre><a href="#section-10.2-3" class="pilcrow">¶</a>
</div>
<span id="name-inner-schc-rule-between-the"></span><div id="fig-rules-oscore-device-server">
<table class="center" id="table-9">
          <caption>
<a href="#table-9" class="selfRef">Table 9</a>:
<a href="#name-inner-schc-rule-between-the" class="selfRef">Inner SCHC Rule between the Device and the Application Server</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">[1, 2, <br> 3, 4]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[65, 68, <br> 69, 132]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">CC</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Path</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"temperature"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-10.2-5">The Device and the proxy share the SCHC Rule shown in <a href="#fig-rules-oscore-device-proxy" class="auto internal xref">Table 10</a>, with RuleID 3. The Device and the proxy use this Rule to perform the Outer SCHC Compression/Decompression hop-by-hop on their communication leg.<a href="#section-10.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-6">
<pre>
+----------+
| RuleID 3 |
+----------+
</pre><a href="#section-10.2-6" class="pilcrow">¶</a>
</div>
<span id="name-outer-schc-rule-between-the"></span><div id="fig-rules-oscore-device-proxy">
<table class="center" id="table-10">
          <caption>
<a href="#table-10" class="selfRef">Table 10</a>:
<a href="#name-outer-schc-rule-between-the" class="selfRef">Outer SCHC Rule between the Device and the Proxy</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[0, 2]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">T</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">68</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x80</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Host</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x09</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(4)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">PPPP</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x0000</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">KKKK</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kidctx</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_x</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_nonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.x.m</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_y</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_oldnonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.y.w</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Proxy-Scheme</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">"coap"</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-10.2-8">The proxy and the Application Server share the SCHC Rule shown in <a href="#fig-rules-oscore-proxy-server" class="auto internal xref">Table 11</a>, with RuleID 4. The proxy and the Application Server use this Rule to perform the Outer SCHC Compression/Decompression hop-by-hop on their communication leg.<a href="#section-10.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-9">
<pre>
 +----------+
 | RuleID 4 |
 +----------+
</pre><a href="#section-10.2-9" class="pilcrow">¶</a>
</div>
<span id="name-outer-schc-rule-between-the-"></span><div id="fig-rules-oscore-proxy-server">
<table class="center" id="table-11">
          <caption>
<a href="#table-11" class="selfRef">Table 11</a>:
<a href="#name-outer-schc-rule-between-the-" class="selfRef">Outer SCHC Rule between the Proxy and the Application Server</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field</th>
              <th class="text-left" rowspan="1" colspan="1">FL</th>
              <th class="text-left" rowspan="1" colspan="1">FP</th>
              <th class="text-left" rowspan="1" colspan="1">DI</th>
              <th class="text-left" rowspan="1" colspan="1">TV</th>
              <th class="text-left" rowspan="1" colspan="1">MO</th>
              <th class="text-left" rowspan="1" colspan="1">CDA</th>
              <th class="text-left" rowspan="1" colspan="1">Sent <br> [bits]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Version</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Type</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">[0, 2]</td>
              <td class="text-left" rowspan="1" colspan="1">match- <br> mapping</td>
              <td class="text-left" rowspan="1" colspan="1">mapping- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1">T</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> TKL</td>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Code</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">68</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> MID</td>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">MMMM</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Token</td>
              <td class="text-left" rowspan="1" colspan="1">tkl</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">0x70</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(5)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">TTT</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> Uri-Host</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (B)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
              <td class="text-left" rowspan="1" colspan="1">ignore</td>
              <td class="text-left" rowspan="1" colspan="1">value- <br> sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x09</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x00</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(4)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">PPPP</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var <br> (b)</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Up</td>
              <td class="text-left" rowspan="1" colspan="1">0x0000</td>
              <td class="text-left" rowspan="1" colspan="1">MSB(12)</td>
              <td class="text-left" rowspan="1" colspan="1">LSB</td>
              <td class="text-left" rowspan="1" colspan="1">KKKK</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kidctx</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_x</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_nonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.x.m</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_y</td>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_oldnonce</td>
              <td class="text-left" rowspan="1" colspan="1">osc.y.w</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Bi</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_flags</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_piv</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CoAP <br> OSCORE_kid</td>
              <td class="text-left" rowspan="1" colspan="1">var</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Dw</td>
              <td class="text-left" rowspan="1" colspan="1">b''</td>
              <td class="text-left" rowspan="1" colspan="1">equal</td>
              <td class="text-left" rowspan="1" colspan="1">not-sent</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-10.2-11">When the Device applies the Rule in <a href="#fig-rules-oscore-device-server" class="auto internal xref">Table 9</a> shared with the Application Server to the CoAP request in <a href="#fig-example-req" class="auto internal xref">Figure 19</a>, this results in the Compressed Plaintext shown in <a href="#fig-plaintext-req" class="auto internal xref">Figure 27</a>.<a href="#section-10.2-11" class="pilcrow">¶</a></p>
<p id="section-10.2-12">As per <a href="#ssec-examples-oscore" class="auto internal xref">Section 8.2</a>, the message follows the process of SCHC Inner Compression and encryption until the payload (if any). The ciphertext resulting from the overall Inner process is used as payload of the Outer OSCORE message.<a href="#section-10.2-12" class="pilcrow">¶</a></p>
<span id="name-plaintext-compression-and-enc"></span><div id="fig-plaintext-req">
<figure id="figure-27">
          <div id="section-10.2-13.1">
            <div class="alignCenter art-svg artwork" id="section-10.2-13.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="784" width="448" viewBox="0 0 448 784" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,208" fill="none" stroke="black"></path>
                <path d="M 8,288 L 8,544" fill="none" stroke="black"></path>
                <path d="M 8,640 L 8,752" fill="none" stroke="black"></path>
                <path d="M 200,216 L 200,280" fill="none" stroke="black"></path>
                <path d="M 200,552 L 200,632" fill="none" stroke="black"></path>
                <path d="M 400,640 L 400,752" fill="none" stroke="black"></path>
                <path d="M 408,288 L 408,544" fill="none" stroke="black"></path>
                <path d="M 440,32 L 440,208" fill="none" stroke="black"></path>
                <path d="M 8,32 L 440,32" fill="none" stroke="black"></path>
                <path d="M 8,208 L 440,208" fill="none" stroke="black"></path>
                <path d="M 8,288 L 408,288" fill="none" stroke="black"></path>
                <path d="M 8,544 L 408,544" fill="none" stroke="black"></path>
                <path d="M 8,640 L 400,640" fill="none" stroke="black"></path>
                <path d="M 8,752 L 400,752" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="208,632 196,626.4 196,637.6" fill="black" transform="rotate(90,200,632)"></polygon>
                <polygon class="arrowhead" points="208,280 196,274.4 196,285.6" fill="black" transform="rotate(90,200,280)"></polygon>
                <g class="text">
                  <text x="44" y="68">OSCORE</text>
                  <text x="112" y="68">Plaintext</text>
                  <text x="132" y="100">0x01bb74656d7065726174757265</text>
                  <text x="272" y="100">(13</text>
                  <text x="316" y="100">bytes)</text>
                  <text x="36" y="132">0x01</text>
                  <text x="88" y="132">Request</text>
                  <text x="140" y="132">Code</text>
                  <text x="176" y="132">GET</text>
                  <text x="164" y="164">0xbb74656d7065726174757265</text>
                  <text x="300" y="164">Option</text>
                  <text x="344" y="164">11:</text>
                  <text x="396" y="164">Uri-Path</text>
                  <text x="296" y="180">Value</text>
                  <text x="328" y="180">=</text>
                  <text x="384" y="180">temperature</text>
                  <text x="232" y="244">Inner</text>
                  <text x="276" y="244">SCHC</text>
                  <text x="344" y="244">Compression</text>
                  <text x="60" y="324">Compressed</text>
                  <text x="144" y="324">Plaintext</text>
                  <text x="44" y="356">0x0200</text>
                  <text x="84" y="356">(2</text>
                  <text x="124" y="356">bytes)</text>
                  <text x="44" y="404">RuleID</text>
                  <text x="80" y="404">=</text>
                  <text x="108" y="404">0x02</text>
                  <text x="140" y="404">(1</text>
                  <text x="176" y="404">byte)</text>
                  <text x="64" y="452">Compression</text>
                  <text x="144" y="452">residue</text>
                  <text x="32" y="468">and</text>
                  <text x="76" y="468">padded</text>
                  <text x="136" y="468">payload</text>
                  <text x="176" y="468">=</text>
                  <text x="204" y="468">0x00</text>
                  <text x="236" y="468">(1</text>
                  <text x="272" y="468">byte)</text>
                  <text x="36" y="500">0b00</text>
                  <text x="68" y="500">(2</text>
                  <text x="100" y="500">bits</text>
                  <text x="176" y="500">match-mapping</text>
                  <text x="280" y="500">Compression</text>
                  <text x="364" y="500">Residue)</text>
                  <text x="52" y="516">0b000000</text>
                  <text x="100" y="516">(6</text>
                  <text x="128" y="516">bit</text>
                  <text x="180" y="516">padding)</text>
                  <text x="228" y="580">AEAD</text>
                  <text x="292" y="580">Encryption</text>
                  <text x="236" y="596">(piv</text>
                  <text x="264" y="596">=</text>
                  <text x="296" y="596">0x04)</text>
                  <text x="96" y="676">encrypted_plaintext</text>
                  <text x="184" y="676">=</text>
                  <text x="220" y="676">0xa2cf</text>
                  <text x="260" y="676">(2</text>
                  <text x="300" y="676">bytes)</text>
                  <text x="32" y="692">tag</text>
                  <text x="56" y="692">=</text>
                  <text x="140" y="692">0xc54fe1b434297b62</text>
                  <text x="228" y="692">(8</text>
                  <text x="268" y="692">bytes)</text>
                  <text x="60" y="724">ciphertext</text>
                  <text x="112" y="724">=</text>
                  <text x="212" y="724">0xa2cfc54fe1b434297b62</text>
                  <text x="320" y="724">(10</text>
                  <text x="364" y="724">bytes)</text>
                </g>
              </svg><a href="#section-10.2-13.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-27" class="selfRef">Figure 27</a>:
<a href="#name-plaintext-compression-and-enc" class="selfRef">Plaintext Compression and Encryption for the GET Request</a>
          </figcaption></figure>
</div>
<p id="section-10.2-14">When the Application Server applies the Rule in <a href="#fig-rules-oscore-device-server" class="auto internal xref">Table 9</a> shared with the Device to the CoAP response in <a href="#fig-example-resp" class="auto internal xref">Figure 20</a>, this results in the Compressed Plaintext shown in <a href="#fig-plaintext-resp" class="auto internal xref">Figure 28</a>.<a href="#section-10.2-14" class="pilcrow">¶</a></p>
<p id="section-10.2-15">As per <a href="#ssec-examples-oscore" class="auto internal xref">Section 8.2</a>, the message follows the process of SCHC Inner Compression and encryption until the payload (if any). The ciphertext resulting from the overall Inner process is used as payload of the Outer OSCORE message.<a href="#section-10.2-15" class="pilcrow">¶</a></p>
<span id="name-plaintext-compression-and-encr"></span><div id="fig-plaintext-resp">
<figure id="figure-28">
          <div id="section-10.2-16.1">
            <div class="alignCenter art-svg artwork" id="section-10.2-16.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="816" width="480" viewBox="0 0 480 816" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,224" fill="none" stroke="black"></path>
                <path d="M 8,304 L 8,576" fill="none" stroke="black"></path>
                <path d="M 8,672 L 8,784" fill="none" stroke="black"></path>
                <path d="M 168,232 L 168,296" fill="none" stroke="black"></path>
                <path d="M 168,584 L 168,664" fill="none" stroke="black"></path>
                <path d="M 408,32 L 408,224" fill="none" stroke="black"></path>
                <path d="M 408,304 L 408,576" fill="none" stroke="black"></path>
                <path d="M 472,672 L 472,784" fill="none" stroke="black"></path>
                <path d="M 8,32 L 408,32" fill="none" stroke="black"></path>
                <path d="M 8,224 L 408,224" fill="none" stroke="black"></path>
                <path d="M 8,304 L 408,304" fill="none" stroke="black"></path>
                <path d="M 8,576 L 408,576" fill="none" stroke="black"></path>
                <path d="M 8,672 L 472,672" fill="none" stroke="black"></path>
                <path d="M 8,784 L 472,784" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="176,664 164,658.4 164,669.6" fill="black" transform="rotate(90,168,664)"></polygon>
                <polygon class="arrowhead" points="176,296 164,290.4 164,301.6" fill="black" transform="rotate(90,168,296)"></polygon>
                <g class="text">
                  <text x="44" y="68">OSCORE</text>
                  <text x="112" y="68">Plaintext</text>
                  <text x="76" y="100">0x45ff32332043</text>
                  <text x="156" y="100">(6</text>
                  <text x="196" y="100">bytes)</text>
                  <text x="36" y="132">0x45</text>
                  <text x="100" y="132">Successful</text>
                  <text x="180" y="132">Response</text>
                  <text x="236" y="132">Code</text>
                  <text x="268" y="132">69</text>
                  <text x="304" y="132">"2.05</text>
                  <text x="364" y="132">Content"</text>
                  <text x="68" y="164">0xff</text>
                  <text x="120" y="164">Payload</text>
                  <text x="180" y="164">marker</text>
                  <text x="124" y="196">0x32332043</text>
                  <text x="200" y="196">Payload</text>
                  <text x="200" y="260">Inner</text>
                  <text x="244" y="260">SCHC</text>
                  <text x="312" y="260">Compression</text>
                  <text x="60" y="340">Compressed</text>
                  <text x="144" y="340">Plaintext</text>
                  <text x="76" y="372">0x028c8cc810c0</text>
                  <text x="148" y="372">(6</text>
                  <text x="188" y="372">bytes)</text>
                  <text x="44" y="420">RuleID</text>
                  <text x="80" y="420">=</text>
                  <text x="108" y="420">0x02</text>
                  <text x="64" y="468">Compression</text>
                  <text x="144" y="468">residue</text>
                  <text x="32" y="484">and</text>
                  <text x="76" y="484">padded</text>
                  <text x="136" y="484">payload</text>
                  <text x="176" y="484">=</text>
                  <text x="236" y="484">0x8c8cc810c0</text>
                  <text x="300" y="484">(5</text>
                  <text x="340" y="484">bytes)</text>
                  <text x="36" y="516">0b10</text>
                  <text x="68" y="516">(2</text>
                  <text x="100" y="516">bits</text>
                  <text x="176" y="516">match-mapping</text>
                  <text x="280" y="516">Compression</text>
                  <text x="364" y="516">Residue)</text>
                  <text x="108" y="532">0x32332043</text>
                  <text x="164" y="532">&gt;&gt;</text>
                  <text x="184" y="532">2</text>
                  <text x="228" y="532">(shifted</text>
                  <text x="300" y="532">payload)</text>
                  <text x="236" y="548">0b000000</text>
                  <text x="304" y="548">Padding</text>
                  <text x="196" y="612">AEAD</text>
                  <text x="260" y="612">Encryption</text>
                  <text x="204" y="628">(piv</text>
                  <text x="232" y="628">=</text>
                  <text x="264" y="628">0x04)</text>
                  <text x="104" y="708">encrypted_plaintext</text>
                  <text x="192" y="708">=</text>
                  <text x="260" y="708">0x10c6d7c26cc1</text>
                  <text x="332" y="708">(6</text>
                  <text x="372" y="708">bytes)</text>
                  <text x="40" y="724">tag</text>
                  <text x="64" y="724">=</text>
                  <text x="148" y="724">0xe9aef3f2461e0c29</text>
                  <text x="236" y="724">(8</text>
                  <text x="276" y="724">bytes)</text>
                  <text x="68" y="756">ciphertext</text>
                  <text x="120" y="756">=</text>
                  <text x="252" y="756">0x10c6d7c26cc1e9aef3f2461e0c29</text>
                  <text x="392" y="756">(14</text>
                  <text x="436" y="756">bytes)</text>
                </g>
              </svg><a href="#section-10.2-16.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-28" class="selfRef">Figure 28</a>:
<a href="#name-plaintext-compression-and-encr" class="selfRef">Plaintext Compression and Encryption for the Content Response</a>
          </figcaption></figure>
</div>
<p id="section-10.2-17">After having performed the SCHC Inner Compression of the CoAP request in <a href="#fig-example-req" class="auto internal xref">Figure 19</a>, the Device protects it with OSCORE by considering the Compressed Plaintext in <a href="#fig-plaintext-req" class="auto internal xref">Figure 27</a>. The result is the OSCORE-protected CoAP request shown in <a href="#fig-example-oscore-req" class="auto internal xref">Figure 29</a>.<a href="#section-10.2-17" class="pilcrow">¶</a></p>
<span id="name-protected-and-inner-schc-comp"></span><div id="fig-example-oscore-req">
<figure id="figure-29">
          <div class="alignLeft art-text artwork" id="section-10.2-18.1">
<pre>
Protected message:
==================
0x41020001823b6578616d706c652e636f6d
  6409040005d411636f6170ffa2cfc54fe1b434297b62
(39 bytes)

Header:
0x4102
01   Ver
  00   CON
    0001   TKL
        00000010   Request Code 2 "POST"

0x0001 = mid
0x82 = token

Options:

0x3b6578616d706c652e636f6d
Option 3: Uri-Host
Value = example.com

0x6409040005
Option 9: OSCORE
Value = 0x09040005
          09 = 000 0 1 001 flag byte
                   h k  n
            04 piv
              0005 kid

0xd411636f6170
Option 39: Proxy-Scheme
Value = coap


0xFF Payload marker

Payload:
0xa2cfc54fe1b434297b62 (10 bytes)

</pre>
</div>
<figcaption><a href="#figure-29" class="selfRef">Figure 29</a>:
<a href="#name-protected-and-inner-schc-comp" class="selfRef">Protected and Inner SCHC Compressed CoAP GET Request</a>
          </figcaption></figure>
</div>
<p id="section-10.2-19">Then, the Device applies the Rule in <a href="#fig-rules-oscore-device-proxy" class="auto internal xref">Table 10</a> shared with the proxy to the OSCORE-protected CoAP request in <a href="#fig-example-oscore-req" class="auto internal xref">Figure 29</a>, thus performing the SCHC Outer Compression of such request. The result is the OSCORE-protected and Outer Compressed CoAP request shown in <a href="#fig-example-oscore-req-to-proxy" class="auto internal xref">Figure 30</a>, which the Device sends to the proxy.<a href="#section-10.2-19" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-get-reques"></span><div id="fig-example-oscore-req-to-proxy">
<figure id="figure-30">
          <div class="alignLeft art-text artwork" id="section-10.2-20.1">
<pre>
Compressed message:
=================
0x03156caf0c2dae0d8ca5cc6deda888b459f8a9fc3686852f6c40 (26 bytes)
0x03 RuleID
    156caf0c2dae0d8ca5cc6deda888b459f8a9fc3686852f6c40 compression
                                                       residue and
                                                       padded payload


Compression Residue
0b 0001 010      1011  |  0x6578616d706c652e636f6d  |
    mid tkn  Uri-Host (residue size and residue)

0b 0100 0100
         piv (residue size and residue)

   0100 0101
         kid (residue size and residue)

   (115 bits -&gt; 15 bytes with padding)

Payload
0xa2cfc54fe1b434297b62 (10 bytes)

Compressed message length: 26 bytes

</pre>
</div>
<figcaption><a href="#figure-30" class="selfRef">Figure 30</a>:
<a href="#name-schc-oscore-coap-get-reques" class="selfRef">SCHC-OSCORE CoAP GET Request Compressed for the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-21">Upon receiving the message in <a href="#fig-example-oscore-req-to-proxy" class="auto internal xref">Figure 30</a>, the proxy decompresses it with the Rule in <a href="#fig-rules-oscore-device-proxy" class="auto internal xref">Table 10</a> shared with the Device, thus performing the SCHC Outer Decompression. The result is the same OSCORE-protected CoAP request in <a href="#fig-example-oscore-req" class="auto internal xref">Figure 29</a>.<a href="#section-10.2-21" class="pilcrow">¶</a></p>
<p id="section-10.2-22">After that, the proxy removes the Proxy-Scheme Option from the decompressed OSCORE-protected CoAP request. Also, the proxy replaces the values of the CoAP Message ID and of the CoAP Token to 0x0004 and 0x75, respectively. The result is the OSCORE-protected CoAP request shown in <a href="#fig-example-oscore-req-from-proxy" class="auto internal xref">Figure 31</a>.<a href="#section-10.2-22" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-get-request"></span><div id="fig-example-oscore-req-from-proxy">
<figure id="figure-31">
          <div class="alignLeft art-text artwork" id="section-10.2-23.1">
<pre>
Protected message:
==================
0x41020004753b6578616d706c652e636f6d
  6409040005ffa2cfc54fe1b434297b62
(33 bytes)

Header:
0x4102
01   Ver
  00   CON
    0001   TKL
        00000010   Request Code 2 "POST"

0x0004 = mid
0x75 = token

Options:

0x3b6578616d706c652e636f6d
Option 3: Uri-Host
Value = example.com

0x6409040005
Option 9: OSCORE
Value = 0x09040005
          09 = 000 0 1 001 flag byte
                   h k  n
            04 piv
              0005 kid


0xFF Payload marker

Payload:
0xa2cfc54fe1b434297b62 (10 bytes)

</pre>
</div>
<figcaption><a href="#figure-31" class="selfRef">Figure 31</a>:
<a href="#name-schc-oscore-coap-get-request" class="selfRef">SCHC-OSCORE CoAP GET Request to be Compressed by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-24">Then, the proxy applies the Rule in <a href="#fig-rules-oscore-proxy-server" class="auto internal xref">Table 11</a> shared with the Application Server to the OSCORE-protected CoAP request in <a href="#fig-example-oscore-req-from-proxy" class="auto internal xref">Figure 31</a>, thus performing the SCHC Outer Compression of such request. The result is the OSCORE-protected and Outer Compressed CoAP request shown in <a href="#fig-example-oscore-req-from-proxy-compressed" class="auto internal xref">Figure 32</a>, which the proxy forwards to the Application Server.<a href="#section-10.2-24" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-get-request-"></span><div id="fig-example-oscore-req-from-proxy-compressed">
<figure id="figure-32">
          <div class="alignLeft art-text artwork" id="section-10.2-25.1">
<pre>
Compressed message:
=================
0x044b6caf0c2dae0d8ca5cc6deda888b459f8a9fc3686852f6c40 (26 bytes)
0x04 RuleID
    4b6caf0c2dae0d8ca5cc6deda888b459f8a9fc3686852f6c40 compression
                                                       residue and
                                                       padded payload


Compression Residue
0b 0100 101      1011  |  0x6578616d706c652e636f6d
    mid tkn  Uri-Host (residue size and residue)

0b 0100 0100
         piv (residue size and residue)

0b 0100 0101
         kid (residue size and residue)

   (115 bits -&gt; 15 bytes with padding)


Payload
0xa2cfc54fe1b434297b62 (10 bytes)

Compressed message length: 26 bytes

</pre>
</div>
<figcaption><a href="#figure-32" class="selfRef">Figure 32</a>:
<a href="#name-schc-oscore-coap-get-request-" class="selfRef">SCHC-OSCORE CoAP GET Request Forwarded by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-26">Upon receiving the message in <a href="#fig-example-oscore-req-from-proxy-compressed" class="auto internal xref">Figure 32</a>, the Application Server decompresses it using the Rule in <a href="#fig-rules-oscore-proxy-server" class="auto internal xref">Table 11</a> shared with the proxy, thus performing the SCHC Outer Decompression. The result is the same OSCORE-protected CoAP request in <a href="#fig-example-oscore-req-from-proxy" class="auto internal xref">Figure 31</a>.<a href="#section-10.2-26" class="pilcrow">¶</a></p>
<p id="section-10.2-27">The Application Server decrypts and verifies such a request, which results in the same Compressed Plaintext in <a href="#fig-plaintext-req" class="auto internal xref">Figure 27</a>. Then, the Application Server applies the Rule in <a href="#fig-rules-oscore-device-server" class="auto internal xref">Table 9</a> shared with the Device to such a Compressed Plaintext, thus performing the SCHC Inner Decompression. The result is used to rebuild the same CoAP request in <a href="#fig-example-req" class="auto internal xref">Figure 19</a>, which the Application Server delivers to the application.<a href="#section-10.2-27" class="pilcrow">¶</a></p>
<p id="section-10.2-28">After having performed the SCHC Inner Compression of the CoAP response in <a href="#fig-example-resp" class="auto internal xref">Figure 20</a>, the Application Server protects it with OSCORE by considering the Compressed Plaintext in <a href="#fig-plaintext-resp" class="auto internal xref">Figure 28</a>. The result is the OSCORE-protected CoAP response shown in <a href="#fig-example-oscore-resp" class="auto internal xref">Figure 33</a>.<a href="#section-10.2-28" class="pilcrow">¶</a></p>
<span id="name-protected-and-inner-schc-compr"></span><div id="fig-example-oscore-resp">
<figure id="figure-33">
          <div class="alignLeft art-text artwork" id="section-10.2-29.1">
<pre>
Protected message:
==================
0x614400047590ff10c6d7c26cc1e9aef3f2461e0c29
(21 bytes)

Header:
0x6144
01   Ver
  10   ACK
    0001   TKL
        01000100   Successful Response Code 68 "2.04 Changed"

0x0004 = mid
0x75 = token

Options:

0x90
Option 9: OSCORE
Value = b''


0xFF Payload marker

Payload:
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)

</pre>
</div>
<figcaption><a href="#figure-33" class="selfRef">Figure 33</a>:
<a href="#name-protected-and-inner-schc-compr" class="selfRef">Protected and Inner SCHC Compressed CoAP Content Response</a>
          </figcaption></figure>
</div>
<p id="section-10.2-30">Then, the Application Server applies the Rule in <a href="#fig-rules-oscore-proxy-server" class="auto internal xref">Table 11</a> shared with the proxy to the OSCORE-protected CoAP response in <a href="#fig-example-oscore-resp" class="auto internal xref">Figure 33</a>, thus performing the SCHC Outer Compression of such response. The result is the OSCORE-protected and Outer Compressed CoAP response shown in <a href="#fig-example-oscore-resp-to-proxy" class="auto internal xref">Figure 34</a>, which the Application Server sends to the proxy.<a href="#section-10.2-30" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-content-re"></span><div id="fig-example-oscore-resp-to-proxy">
<figure id="figure-34">
          <div class="alignLeft art-text artwork" id="section-10.2-31.1">
<pre>
Compressed message:
=================
0x04a510c6d7c26cc1e9aef3f2461e0c29  (16 bytes)
0x04 RuleID
    a510c6d7c26cc1e9aef3f2461e0c29 compression residue
                                   and padded payload


Compression Residue (8 bits -&gt; 1 byte with padding)
0b    1 0100 101
   type  mid tkn

Payload
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)

Compressed message length: 16 bytes

</pre>
</div>
<figcaption><a href="#figure-34" class="selfRef">Figure 34</a>:
<a href="#name-schc-oscore-coap-content-re" class="selfRef">SCHC-OSCORE CoAP Content Response Compressed for the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-32">Upon receiving the message in <a href="#fig-example-oscore-resp-to-proxy" class="auto internal xref">Figure 34</a>, the proxy decompresses it with the Rule in <a href="#fig-rules-oscore-proxy-server" class="auto internal xref">Table 11</a> shared with the Application Server, thus performing the SCHC Outer Decompression. The result is the same OSCORE-protected CoAP response in <a href="#fig-example-oscore-resp" class="auto internal xref">Figure 33</a>.<a href="#section-10.2-32" class="pilcrow">¶</a></p>
<p id="section-10.2-33">After that, the proxy replaces the values of the CoAP Message ID and of the CoAP Token to 0x0001 and 0x82, respectively. The result is the OSCORE-protected CoAP response shown in <a href="#fig-example-oscore-resp-from-proxy" class="auto internal xref">Figure 35</a>.<a href="#section-10.2-33" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-content-res"></span><div id="fig-example-oscore-resp-from-proxy">
<figure id="figure-35">
          <div class="alignLeft art-text artwork" id="section-10.2-34.1">
<pre>
Protected message:
==================
0x614400018290ff10c6d7c26cc1e9aef3f2461e0c29
(21 bytes)

Header:
0x6144
01   Ver
  10   ACK
    0001   TKL
        01000100   Successful Response Code 68 "2.04 Changed"

0x0001 = mid
0x82 = token

Options:

0x90
Option 9: OSCORE
Value = b''


0xFF Payload marker

Payload:
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)

</pre>
</div>
<figcaption><a href="#figure-35" class="selfRef">Figure 35</a>:
<a href="#name-schc-oscore-coap-content-res" class="selfRef">SCHC-OSCORE CoAP Content Response to be Compressed by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-35">Then, the proxy applies the Rule in <a href="#fig-rules-oscore-device-proxy" class="auto internal xref">Table 10</a> shared with the Device to the OSCORE-protected CoAP response in <a href="#fig-example-oscore-resp-from-proxy" class="auto internal xref">Figure 35</a>, thus performing the SCHC Outer Compression of such response. The result is the OSCORE-protected and Outer Compressed CoAP response shown in <a href="#fig-example-oscore-resp-from-proxy-compressed" class="auto internal xref">Figure 36</a>, which the proxy forwards to the Device.<a href="#section-10.2-35" class="pilcrow">¶</a></p>
<span id="name-schc-oscore-coap-content-resp"></span><div id="fig-example-oscore-resp-from-proxy-compressed">
<figure id="figure-36">
          <div class="alignLeft art-text artwork" id="section-10.2-36.1">
<pre>
Compressed message:
=================
0x038a10c6d7c26cc1e9aef3f2461e0c29 (16 bytes)
0x03 RuleID
    8a10c6d7c26cc1e9aef3f2461e0c29 compression residue
                                   and padded payload


Compression Residue (8 bits -&gt; 1 byte with padding)
0b    1 0001 010
   type  mid tkn

Payload
0x10c6d7c26cc1e9aef3f2461e0c29 (14 bytes)

Compressed message length: 16 bytes

</pre>
</div>
<figcaption><a href="#figure-36" class="selfRef">Figure 36</a>:
<a href="#name-schc-oscore-coap-content-resp" class="selfRef">SCHC-OSCORE CoAP Content Response Forwarded by the Proxy</a>
          </figcaption></figure>
</div>
<p id="section-10.2-37">Upon receiving the message in <a href="#fig-example-oscore-resp-from-proxy-compressed" class="auto internal xref">Figure 36</a>, the Device decompresses it using the Rule in <a href="#fig-rules-oscore-device-proxy" class="auto internal xref">Table 10</a> shared with the proxy, thus performing the SCHC Outer Decompression. The result is the same OSCORE-protected CoAP response in <a href="#fig-example-oscore-resp-from-proxy" class="auto internal xref">Figure 35</a>.<a href="#section-10.2-37" class="pilcrow">¶</a></p>
<p id="section-10.2-38">The Device decrypts and verifies such a response, which results in the same Compressed Plaintext in <a href="#fig-plaintext-resp" class="auto internal xref">Figure 28</a>. Then, the Device applies the Rule in <a href="#fig-rules-oscore-device-server" class="auto internal xref">Table 9</a> shared with the Application Server to such a Compressed Plaintext, thus performing the SCHC Inner Decompression. The result is used to rebuild the same CoAP response in <a href="#fig-example-resp" class="auto internal xref">Figure 20</a>, which the Device delivers to the application.<a href="#section-10.2-38" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-coap-fields">
<section id="section-11">
      <h2 id="name-coap-fields">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-coap-fields" class="section-name selfRef">CoAP Fields</a>
      </h2>
<p id="section-11-1"><a href="#_table-coap-fields" class="auto internal xref">Table 12</a> lists the CoAP fields and subfields for which SCHC Compression has been defined or revised in this document.<a href="#section-11-1" class="pilcrow">¶</a></p>
<span id="name-coap-fields-2"></span><div id="_table-coap-fields">
<table class="center" id="table-12">
        <caption>
<a href="#table-12" class="selfRef">Table 12</a>:
<a href="#name-coap-fields-2" class="selfRef">CoAP Fields</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Version</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Version <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Type</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Type <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Token Length (TKL)</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Token Length (TKL) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span><span>[<a href="#RFC8974" class="cite xref">RFC8974</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Code</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Code <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Code Class</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Code (subfield Class) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Code Detail</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Code (subfield Detail) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP MID</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP header field Message ID <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Token</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP field Token <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span><span>[<a href="#RFC8974" class="cite xref">RFC8974</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP If-Match</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option If-Match <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Uri-Host</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Uri-Host <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP ETag</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option ETag <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP If-None-Match</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option If-None-Match <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Observe</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Uri-Port</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Uri-Port <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Location-Path</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Location-Path <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span><span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE Flags</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield Flags) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span><span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE PIV</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield PIV) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE kid</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield kid) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE kidctx</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield kid context) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE x</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield x) <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE nonce</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield nonce) <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE y</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield y) <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP OSCORE old_nonce</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option OSCORE (subfield old_nonce) <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Uri-Path</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Uri-Path <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Content-Format</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Content-Format <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Max-Age</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Max-Age <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Uri-Query</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Uri-Query <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Accept</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Accept <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Location-Query</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Location-Query <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Block2</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Block2 <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span><span>[<a href="#RFC8323" class="cite xref">RFC8323</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Block1</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Block1 <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span><span>[<a href="#RFC8323" class="cite xref">RFC8323</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Size2</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Size2 <span>[<a href="#RFC7959" class="cite xref">RFC7959</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Proxy-Uri</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Proxy-Uri <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Proxy-Scheme</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Proxy-Scheme <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Size1</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Size1 <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Proxy-Cri</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Proxy-Cri <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Proxy-Scheme-Number</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Proxy-Scheme-Number <span>[<a href="#I-D.ietf-core-href" class="cite xref">I-D.ietf-core-href</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP No-Response</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option No-Response <span>[<a href="#RFC7967" class="cite xref">RFC7967</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Hop-Limit</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Hop-Limit <span>[<a href="#RFC8768" class="cite xref">RFC8768</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Echo</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Echo <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Request-Tag</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Request-Tag <span>[<a href="#RFC9175" class="cite xref">RFC9175</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Q-Block1</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Q-Block1 <span>[<a href="#RFC9177" class="cite xref">RFC9177</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP Q-Block2</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option Q-Block2 <span>[<a href="#RFC9177" class="cite xref">RFC9177</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CoAP EDHOC</td>
            <td class="text-left" rowspan="1" colspan="1">CoAP option EDHOC <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>
</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-12">
      <h2 id="name-security-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-12-1">The use of SCHC header compression for CoAP header fields only affects the representation of the header information. SCHC header compression itself does not increase or decrease the overall level of security of the communication. When the connection does not use a security protocol (OSCORE, DTLS, etc.), it is necessary to use a Layer 2 security mechanism to protect the SCHC messages.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">If an LPWAN is the Layer 2 technology being used, the SCHC security considerations discussed in <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> continue to apply. When using another Layer 2 protocol, the use of a cryptographic integrity-protection mechanism to protect the SCHC headers is <span class="bcp14">REQUIRED</span>. Such cryptographic integrity protection is necessary in order to continue to provide the properties that <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> relies upon.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">When SCHC is used with OSCORE, the security considerations discussed in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> continue to apply. When SCHC is used with Group OSCORE, the security considerations discussed in <span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="cite xref">I-D.ietf-core-oscore-groupcomm</a>]</span> apply. When SCHC is used in the presence of CoAP proxies, the security considerations discussed in <span><a href="https://rfc-editor.org/rfc/rfc7252#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> continue to apply.<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4">When SCHC is used with the OSCORE Outer headers, the Initialization Vector (IV) size in the Compression Residue must be carefully selected. There is a trade-off between compression efficiency (with a longer MSB MO prefix) and the frequency at which the Device must renew its key material (in order to prevent the IV from expanding to an incompressible value). The key-renewal operation itself may require several message exchanges and result in energy-intensive computation, but the optimal trade-off will depend on the specifics of the Device and expected usage patterns. In order to renew its key material with another OSCORE endpoint, the Device can rely on the lightweight key update protocol KUDOS defined in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>.<a href="#section-12-4" class="pilcrow">¶</a></p>
<p id="section-12-5">If an attacker can introduce a corrupted SCHC-compressed packet onto a link, DoS attacks can be mounted by causing excessive resource consumption at the decompressor. However, an attacker able to inject packets at the link layer is also capable of other, potentially more damaging, attacks.<a href="#section-12-5" class="pilcrow">¶</a></p>
<p id="section-12-6">SCHC compression emits variable-length Compression Residues for some CoAP fields. In the representation of the compressed header, the length field that is sent is not the length of the original header field but rather the length of the Compression Residue that is being transmitted. If a corrupted packet arrives at the decompressor with a longer or shorter length than that of the original compressed representation, the SCHC decompression procedures will detect an error and drop the packet.<a href="#section-12-6" class="pilcrow">¶</a></p>
<p id="section-12-7">SCHC header compression Rules <span class="bcp14">MUST</span> remain tightly coupled between the compressor and the decompressor. If the compression Rules get out of sync, a Compression Residue might be decompressed differently at the receiver, thus yielding a result different than the initial message submitted to compression procedures. Accordingly, any time the context Rules are updated on an OSCORE endpoint, that endpoint <span class="bcp14">MUST</span> trigger OSCORE key re-establishment, e.g., by running the lightweight key update protocol KUDOS <span>[<a href="#I-D.ietf-core-oscore-key-update" class="cite xref">I-D.ietf-core-oscore-key-update</a>]</span>. Similar procedures may be appropriate to signal Rule updates when other message-protection mechanisms are in use.<a href="#section-12-7" class="pilcrow">¶</a></p>
<div id="sec-security-considerations-yang-module">
<section id="section-12.1">
        <h3 id="name-yang-module">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-yang-module" class="section-name selfRef">YANG Module</a>
        </h3>
<p id="section-12.1-1">The YANG data model defined in Appendix A extends the ietf-schc module defined in <span>[<a href="#RFC9363" class="cite xref">RFC9363</a>]</span>.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
<p id="section-12.1-2">Therefore, all the security considerations compiled in <span><a href="https://rfc-editor.org/rfc/rfc9363#section-8" class="relref">Section 8</a> of [<a href="#RFC9363" class="cite xref">RFC9363</a>]</span> apply to the resulting, extended YANG data model as well.<a href="#section-12.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-13">
      <h2 id="name-iana-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-13-1">This document has the following actions for IANA.<a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">Note to RFC Editor: Please replace all occurrences of "[RFC-XXXX]" with the RFC number of this specification and delete this paragraph.<a href="#section-13-2" class="pilcrow">¶</a></p>
<div id="ietf-xml">
<section id="section-13.1">
        <h3 id="name-ietf-xml">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-ietf-xml" class="section-name selfRef">IETF XML</a>
        </h3>
<p id="section-13.1-1">IANA is asked to register the following entry in the "IETF XML" registry <span>[<a href="#RFC3688" class="cite xref">RFC3688</a>]</span>.<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.1-2.1">
            <p id="section-13.1-2.1.1">URI: urn:ietf:params:xml:ns:yang:ietf-schc-coap<a href="#section-13.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.1-2.2">
            <p id="section-13.1-2.2.1">Registrant Contact: The IESG.<a href="#section-13.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.1-2.3">
            <p id="section-13.1-2.3.1">XML: N/A; the requested URI is an XML namespace.<a href="#section-13.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="yang-module-names">
<section id="section-13.2">
        <h3 id="name-yang-module-names">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-yang-module-names" class="section-name selfRef">YANG Module Names</a>
        </h3>
<p id="section-13.2-1">IANA is asked to register the following entry in the "YANG Module Names" registry <span>[<a href="#RFC6020" class="cite xref">RFC6020</a>]</span><span>[<a href="#RFC8407" class="cite xref">RFC8407</a>]</span> within the "YANG Parameters" registry group.<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.2-2.1">
            <p id="section-13.2-2.1.1">Name: ietf-schc-coap<a href="#section-13.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.2-2.2">
            <p id="section-13.2-2.2.1">Namespace: urn:ietf:params:xml:ns:yang:ietf-schc-coap<a href="#section-13.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.2-2.3">
            <p id="section-13.2-2.3.1">Prefix: schc-coap<a href="#section-13.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.2-2.4">
            <p id="section-13.2-2.4.1">Reference: [RFC-XXXX]<a href="#section-13.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-iana-coap-fields">
<section id="section-13.3">
        <h3 id="name-schc-compression-of-coap-fi">
<a href="#section-13.3" class="section-number selfRef">13.3. </a><a href="#name-schc-compression-of-coap-fi" class="section-name selfRef">SCHC Compression of CoAP Fields</a>
        </h3>
<p id="section-13.3-1">IANA is asked to establish the "SCHC Compression of CoAP Fields" IANA registry.<a href="#section-13.3-1" class="pilcrow">¶</a></p>
<p id="section-13.3-2">As registration policy, the registry uses "Specification Required" per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.6" class="relref">Section 4.6</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Expert Review guidelines are provided in <a href="#sec-iana-expert-review" class="auto internal xref">Section 13.4</a>.<a href="#section-13.3-2" class="pilcrow">¶</a></p>
<div id="intended-use">
<section id="section-13.3.1">
          <h4 id="name-intended-use">
<a href="#section-13.3.1" class="section-number selfRef">13.3.1. </a><a href="#name-intended-use" class="section-name selfRef">Intended Use</a>
          </h4>
<p id="section-13.3.1-1">The objective of this registry is to collect a list of CoAP fields and subfields, for which it has been defined how to perform SCHC compression.<a href="#section-13.3.1-1" class="pilcrow">¶</a></p>
<p id="section-13.3.1-2">Such a definition does not necessarily have to be in the same documentation that defines the CoAP fields and subfields in question. While that can be the case, it is also possible to provide that definition in a separate specification.<a href="#section-13.3.1-2" class="pilcrow">¶</a></p>
<p id="section-13.3.1-3">Each entry of the registry is intended to include references to the documentation that defines the associated CoAP field or subfield, as well as references to the specifications that define the SCHC compression of that CoAP field or subfield.<a href="#section-13.3.1-3" class="pilcrow">¶</a></p>
<p id="section-13.3.1-4">When a specification defines how to perform SCHC compression of a CoAP field, the following applies.<a href="#section-13.3.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.3.1-5.1">
              <p id="section-13.3.1-5.1.1">If a registry entry for the CoAP field does not already exist, it is strongly encouraged to register an associated new entry.<a href="#section-13.3.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.3.1-5.2">
              <p id="section-13.3.1-5.2.1">If a registry entry for the CoAP field already exists, it is strongly encouraged to update its list of references. The update is intended to add references to the specification that provides the new or updated SCHC compression of the CoAP field, as well as to any documentation that updates the definition of the CoAP field itself.<a href="#section-13.3.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-13.3.1-6">If the defined SCHC compression considers the CoAP field as composed of subfields, it is strongly encouraged that the same as above is also performed for each subfield and the associated registry entry.<a href="#section-13.3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="structure-of-entries">
<section id="section-13.3.2">
          <h4 id="name-structure-of-entries">
<a href="#section-13.3.2" class="section-number selfRef">13.3.2. </a><a href="#name-structure-of-entries" class="section-name selfRef">Structure of Entries</a>
          </h4>
<p id="section-13.3.2-1">The columns of this registry are:<a href="#section-13.3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.3.2-2.1">
              <p id="section-13.3.2-2.1.1">Field: a unique identifier of the CoAP field or subfield associated with this entry. This identifier can be used as value of the "Field" column in a SCHC compression Rule. This identifier must have a corresponding item or set of items in the YANG data model for the CoAP field or subfield associated with this entry, as specified in <span><a href="https://rfc-editor.org/rfc/rfc9363#section-6" class="relref">Section 6</a> of [<a href="#RFC9363" class="cite xref">RFC9363</a>]</span> or in <a href="#sec-yang-module" class="auto internal xref">Appendix A</a> of [RFC-XXXX].<a href="#section-13.3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.3.2-2.2">
              <p id="section-13.3.2-2.2.1">Description: a short description of the CoAP field or subfield associated with this entry, together with public references to the resources that define it.<a href="#section-13.3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-13.3.2-2.3">
              <p id="section-13.3.2-2.3.1">Reference: public references to the resources that define how a SCHC compression Rule works for the CoAP field or subfield associated with this entry.<a href="#section-13.3.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-13.3.2-3">This registry has been initially populated with the values in <a href="#_table-coap-fields" class="auto internal xref">Table 12</a>. The "Reference" column for all of these entries refers to this document.<a href="#section-13.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-iana-expert-review">
<section id="section-13.4">
        <h3 id="name-expert-review-instructions">
<a href="#section-13.4" class="section-number selfRef">13.4. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-13.4-1">The IANA registry established in this document is defined as "Specification Required". This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-13.4-1" class="pilcrow">¶</a></p>
<p id="section-13.4-2">Expert reviewers should take into consideration the following points:<a href="#section-13.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.4-3.1">
            <p id="section-13.4-3.1.1">Point squatting should be discouraged. Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments.<a href="#section-13.4-3.1.1" class="pilcrow">¶</a></p>
<p id="section-13.4-3.1.2">
Specifically, for every CoAP field, only one corresponding registry entry is allowed. Also, for every CoAP subfield, only one corresponding registry entry is allowed.<a href="#section-13.4-3.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.4-3.2">
            <p id="section-13.4-3.2.1">Consistent with the "Specification Required" registration policy, specifications should exist, but early assignment before a specification is available is considered to be permissible. When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.<a href="#section-13.4-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.4-4">If the expert becomes aware of a definition for SCHC compression of CoAP fields and subfields that is deployed and in use, the expert may also initiate a registration or update an existing one on their own, if they deem important that the definition in question gains visibility through the registry entry.<a href="#section-13.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-14">
      <h2 id="name-references">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-14.1">
        <h3 id="name-normative-references">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-href">[I-D.ietf-core-href]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">H. Birkholz</span>, <span class="refTitle">"Constrained Resource Identifiers"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-href-16</span>, <time datetime="2024-07-24" class="refDate">24 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16">https://datatracker.ietf.org/doc/html/draft-ietf-core-href-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-edhoc">[I-D.ietf-core-oscore-edhoc]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Höglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Using Ephemeral Diffie-Hellman Over COSE (EDHOC) with the Constrained Application Protocol (CoAP) and Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-edhoc-11</span>, <time datetime="2024-04-09" class="refDate">9 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-groupcomm">[I-D.ietf-core-oscore-groupcomm]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">R. Höglund</span>, <span class="refTitle">"Group Object Security for Constrained RESTful Environments (Group OSCORE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-groupcomm-23</span>, <time datetime="2024-09-26" class="refDate">26 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-groupcomm-23</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-key-update">[I-D.ietf-core-oscore-key-update]</dt>
        <dd>
<span class="refAuthor">Höglund, R.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Update for OSCORE (KUDOS)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-key-update-08</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-08">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3688">[RFC3688]</dt>
        <dd>
<span class="refAuthor">Mealling, M.</span>, <span class="refTitle">"The IETF XML Registry"</span>, <span class="seriesInfo">BCP 81</span>, <span class="seriesInfo">RFC 3688</span>, <span class="seriesInfo">DOI 10.17487/RFC3688</span>, <time datetime="2004-01" class="refDate">January 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3688">https://www.rfc-editor.org/rfc/rfc3688</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5116">https://www.rfc-editor.org/rfc/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6020">[RFC6020]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M., Ed.</span>, <span class="refTitle">"YANG - A Data Modeling Language for the Network Configuration Protocol (NETCONF)"</span>, <span class="seriesInfo">RFC 6020</span>, <span class="seriesInfo">DOI 10.17487/RFC6020</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6020">https://www.rfc-editor.org/rfc/rfc6020</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7959">[RFC7959]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">Z. Shelby, Ed.</span>, <span class="refTitle">"Block-Wise Transfers in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7959</span>, <span class="seriesInfo">DOI 10.17487/RFC7959</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7959">https://www.rfc-editor.org/rfc/rfc7959</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7967">[RFC7967]</dt>
        <dd>
<span class="refAuthor">Bhattacharyya, A.</span>, <span class="refAuthor">Bandyopadhyay, S.</span>, <span class="refAuthor">Pal, A.</span>, and <span class="refAuthor">T. Bose</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Option for No Server Response"</span>, <span class="seriesInfo">RFC 7967</span>, <span class="seriesInfo">DOI 10.17487/RFC7967</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7967">https://www.rfc-editor.org/rfc/rfc7967</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8323">[RFC8323]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Lemay, S.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Hartke, K.</span>, <span class="refAuthor">Silverajan, B.</span>, and <span class="refAuthor">B. Raymor, Ed.</span>, <span class="refTitle">"CoAP (Constrained Application Protocol) over TCP, TLS, and WebSockets"</span>, <span class="seriesInfo">RFC 8323</span>, <span class="seriesInfo">DOI 10.17487/RFC8323</span>, <time datetime="2018-02" class="refDate">February 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8323">https://www.rfc-editor.org/rfc/rfc8323</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8407">[RFC8407]</dt>
        <dd>
<span class="refAuthor">Bierman, A.</span>, <span class="refTitle">"Guidelines for Authors and Reviewers of Documents Containing YANG Data Models"</span>, <span class="seriesInfo">BCP 216</span>, <span class="seriesInfo">RFC 8407</span>, <span class="seriesInfo">DOI 10.17487/RFC8407</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8407">https://www.rfc-editor.org/rfc/rfc8407</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8724">[RFC8724]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">Gomez, C.</span>, <span class="refAuthor">Barthel, D.</span>, and <span class="refAuthor">JC. Zuniga</span>, <span class="refTitle">"SCHC: Generic Framework for Static Context Header Compression and Fragmentation"</span>, <span class="seriesInfo">RFC 8724</span>, <span class="seriesInfo">DOI 10.17487/RFC8724</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8724">https://www.rfc-editor.org/rfc/rfc8724</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8768">[RFC8768]</dt>
        <dd>
<span class="refAuthor">Boucadair, M.</span>, <span class="refAuthor">Reddy.K, T.</span>, and <span class="refAuthor">J. Shallow</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Hop-Limit Option"</span>, <span class="seriesInfo">RFC 8768</span>, <span class="seriesInfo">DOI 10.17487/RFC8768</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8768">https://www.rfc-editor.org/rfc/rfc8768</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8974">[RFC8974]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span> and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Extended Tokens and Stateless Clients in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8974</span>, <span class="seriesInfo">DOI 10.17487/RFC8974</span>, <time datetime="2021-01" class="refDate">January 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8974">https://www.rfc-editor.org/rfc/rfc8974</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9175">[RFC9175]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Constrained Application Protocol (CoAP): Echo, Request-Tag, and Token Processing"</span>, <span class="seriesInfo">RFC 9175</span>, <span class="seriesInfo">DOI 10.17487/RFC9175</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9175">https://www.rfc-editor.org/rfc/rfc9175</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9177">[RFC9177]</dt>
        <dd>
<span class="refAuthor">Boucadair, M.</span> and <span class="refAuthor">J. Shallow</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Block-Wise Transfer Options Supporting Robust Transmission"</span>, <span class="seriesInfo">RFC 9177</span>, <span class="seriesInfo">DOI 10.17487/RFC9177</span>, <time datetime="2022-03" class="refDate">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9177">https://www.rfc-editor.org/rfc/rfc9177</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9363">[RFC9363]</dt>
      <dd>
<span class="refAuthor">Minaburo, A.</span> and <span class="refAuthor">L. Toutain</span>, <span class="refTitle">"A YANG Data Model for Static Context Header Compression (SCHC)"</span>, <span class="seriesInfo">RFC 9363</span>, <span class="seriesInfo">DOI 10.17487/RFC9363</span>, <time datetime="2023-03" class="refDate">March 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9363">https://www.rfc-editor.org/rfc/rfc9363</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-14.2">
        <h3 id="name-informative-references">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-groupcomm-bis">[I-D.ietf-core-groupcomm-bis]</dt>
        <dd>
<span class="refAuthor">Dijk, E.</span>, <span class="refAuthor">Wang, C.</span>, and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Group Communication for the Constrained Application Protocol (CoAP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-groupcomm-bis-11</span>, <time datetime="2024-04-24" class="refDate">24 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-groupcomm-bis-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8824">[RFC8824]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, and <span class="refAuthor">R. Andreasen</span>, <span class="refTitle">"Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8824</span>, <span class="seriesInfo">DOI 10.17487/RFC8824</span>, <time datetime="2021-06" class="refDate">June 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8824">https://www.rfc-editor.org/rfc/rfc8824</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9147">[RFC9147]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9147">https://www.rfc-editor.org/rfc/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
      <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9528">https://www.rfc-editor.org/rfc/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-yang-module">
<section id="appendix-A">
      <h2 id="name-yang-data-model">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-yang-data-model" class="section-name selfRef">YANG Data Model</a>
      </h2>
<p id="appendix-A-1">This appendix defines the ietf-schc-coap module, which extends the ietf-schc module defined in <span>[<a href="#RFC9363" class="cite xref">RFC9363</a>]</span> to include the new CoAP options as defined in the present document.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<span id="name-schc-coap-extension-yang-da"></span><div id="fig-yang-data-model">
<figure id="figure-37">
        <div class="breakable sourcecode" id="appendix-A-2.1">
<pre>&lt;CODE BEGINS&gt; file "ietf-schc-coap@2024-10-21.yang"


module ietf-schc-coap {
  yang-version 1.1;
  namespace "urn:ietf:params:xml:ns:yang:ietf-schc-coap";
  prefix schc-coap;

  import ietf-schc {
      prefix schc;
  }

  organization
    "IETF Static Context Header Compression (schc) Working Group";
  contact
    "WG Web:   &lt;https://datatracker.ietf.org/wg/schc/about/&gt;
     WG List:  &lt;mailto:schc@ietf.org&gt;
     Editor:   Marco Tiloca
       &lt;mailto:marco.tiloca@ri.se&gt;";
  description
    "Copyright (c) 2021 IETF Trust and the persons identified as
     authors of the code.  All rights reserved.
     Redistribution and use in source and binary forms, with or
     without modification, is permitted pursuant to, and subject to
     the license terms contained in, the Simplified BSD License set
     forth in Section 4.c of the IETF Trust's Legal Provisions
     Relating to IETF Documents
     (https://trustee.ietf.org/license-info).
     This version of this YANG module is part of RFC XXXX
     (https://www.rfc-editor.org/info/rfcXXXX); see the RFC itself
     for full legal notices.
     The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL
     NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'NOT RECOMMENDED',
     'MAY', and 'OPTIONAL' in this document are to be interpreted as
     described in BCP 14 (RFC 2119) (RFC 8174) when, and only when,
     they appear in all capitals, as shown here.
     ****************************************************************

     This module extends the ietf-schc module defined in RFC 9363 to
     include the new CoAP options as defined in RFC YYYY.";

  revision 2024-10-21 {
    description
      "New CoAP extensions and extended OSCORE fields.";
    reference
      "RFC YYYY Static Context Header Compression (SCHC) for the
                Constrained Application Protocol (CoAP) (see
                Sections 5 and 6)";
  }

  // Field ID

  identity fid-coap-option-proxy-cri {
    base "schc:fid-coap-option";
    description
      "Proxy-Cri option.";
    reference
      "RFC XXXX Constrained Resource Identifiers";
  }

  identity fid-coap-option-proxy-scheme-number {
    base "schc:fid-coap-option";
    description
      "Proxy-Scheme-Number option.";
    reference
      "RFC XXXX Constrained Resource Identifiers";
  }

  identity fid-coap-option-hop-limit {
    base "schc:fid-coap-option";
    description
      "Hop Limit option to avoid infinite forwarding loops.";
    reference
      "RFC 8768 Constrained Application Protocol (CoAP)
                Hop-Limit Option";
  }

  identity fid-coap-option-echo {
    base "schc:fid-coap-option";
    description
      "Echo option.";
    reference
      "RFC 9175 Constrained Application Protocol (CoAP):
                Echo, Request-Tag, and Token Processing";
  }

  identity fid-coap-option-request-tag {
    base "schc:fid-coap-option";
    description
      "Request-Tag option.";
    reference
      "RFC 9175 Constrained Application Protocol (CoAP):
                Echo, Request-Tag, and Token Processing";
  }

  identity fid-coap-option-q-block1 {
    base "schc:fid-coap-option";
    description
      "Q-Block1 option.";
    reference
      "RFC 9177 Constrained Application Protocol (CoAP)
                Block-Wise Transfer Options Supporting
                Robust Transmission";
  }

  identity fid-coap-option-q-block2 {
    base "schc:fid-coap-option";
    description
      "Q-Block2 option.";
    reference
      "RFC 9177 Constrained Application Protocol (CoAP)
                Block-Wise Transfer Options Supporting
                Robust Transmission";
  }

  identity fid-coap-option-edhoc {
    base "schc:fid-coap-option";
    description
      "EDHOC option.";
    reference
      "RFC XXXX Using Ephemeral Diffie-Hellman Over COSE (EDHOC)
                with the Constrained Application Protocol (CoAP)
                and Object Security for Constrained RESTful
                Environments (OSCORE)";
  }

  identity fid-coap-option-oscore-x {
       base "schc:fid-coap-option";
       description
         "CoAP option OSCORE x field.";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }

  identity fid-coap-option-oscore-nonce {
       base "schc:fid-coap-option";
       description
         "CoAP option OSCORE nonce field.";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }

  identity fid-coap-option-oscore-y {
       base "schc:fid-coap-option";
       description
         "CoAP option OSCORE y field.";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }

  identity fid-coap-option-oscore-oldnonce {
       base "schc:fid-coap-option";
       description
         "CoAP option OSCORE old_nonce field.";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }

  // Function Length

  identity fl-oscore-oscore-nonce-length {
       base "schc:fl-base-type";
       description
         "Size in bytes of the OSCORE nonce corresponding to m+1.";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }

  identity fl-oscore-oscore-oldnonce-length {
       base "schc:fl-base-type";
       description
         "Size in bytes of the OSCORE old_nonce corresponding to w+1.
         ";
       reference
         "RFC YYYY Static Context Header Compression (SCHC) for the
                   Constrained Application Protocol (CoAP) (see
                   Section 6.4)
          RFC XXXX Key Update for OSCORE (KUDOS)";
  }
}


&lt;CODE ENDS&gt;</pre>
</div>
<figcaption><a href="#figure-37" class="selfRef">Figure 37</a>:
<a href="#name-schc-coap-extension-yang-da" class="selfRef">SCHC CoAP Extension YANG Data Model</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-B">
      <h2 id="name-document-updates">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-B-1">This section is to be removed before publishing as an RFC.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="sec-02-03">
<section id="appendix-B.1">
        <h3 id="name-version-02-to-03">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1">
            <p id="appendix-B.1-1.1.1">Consistent representation of "CoAP Version" 1 in example Rules.<a href="#appendix-B.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.2">
            <p id="appendix-B.1-1.2.1">Split the compression of Token Length and Token into two sections.<a href="#appendix-B.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.3">
            <p id="appendix-B.1-1.3.1">Disambiguated example of Rule on eliding a Uri-Path option.<a href="#appendix-B.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.4">
            <p id="appendix-B.1-1.4.1">Fixed compression examples with OSCORE.<a href="#appendix-B.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.5">
            <p id="appendix-B.1-1.5.1">Inherited security considerations on the YANG module from RFC 9363.<a href="#appendix-B.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.6">
            <p id="appendix-B.1-1.6.1">Fixes and editorial improvements.<a href="#appendix-B.1-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-B.2">
        <h3 id="name-version-01-to-02">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.2-1.1">
            <p id="appendix-B.2-1.1.1">Added compression for the CoAP options Proxy-Cri and Proxy-Scheme-Number.<a href="#appendix-B.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.2">
            <p id="appendix-B.2-1.2.1">Defined new IANA registry "SCHC Compression of CoAP Fields".<a href="#appendix-B.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.3">
            <p id="appendix-B.2-1.3.1">Updated the YANG data model.<a href="#appendix-B.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.4">
            <p id="appendix-B.2-1.4.1">Fixes and editorial improvements.<a href="#appendix-B.2-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-B.3">
        <h3 id="name-version-00-to-01">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.3-1.1">
            <p id="appendix-B.3-1.1.1">Fixed an example, as per the erratum with Errata ID 7623.<a href="#appendix-B.3-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.2">
            <p id="appendix-B.3-1.2.1">Clarified building of Field Descriptor for CoAP options.<a href="#appendix-B.3-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.3">
            <p id="appendix-B.3-1.3.1">Clarified what SCHC compression considers for CoAP options.<a href="#appendix-B.3-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.4">
            <p id="appendix-B.3-1.4.1">Revised SCHC Compression of the ETag and If-Match CoAP option.<a href="#appendix-B.3-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.5">
            <p id="appendix-B.3-1.5.1">Revised SCHC Compression of the If-None-Match CoAP option.<a href="#appendix-B.3-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.6">
            <p id="appendix-B.3-1.6.1">Added YANG data model for the YANG module.<a href="#appendix-B.3-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.7">
            <p id="appendix-B.3-1.7.1">Added IANA considerations.<a href="#appendix-B.3-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-1.8">
            <p id="appendix-B.3-1.8.1">Fixes and editorial improvements.<a href="#appendix-B.3-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The authors sincerely thank <span class="contact-name">Christian Amsüss</span>, <span class="contact-name">Quentin Lampin</span>, <span class="contact-name">John Preuß Mattsson</span>, <span class="contact-name">Carles Gomez Montenegro</span>, <span class="contact-name">Göran Selander</span>, <span class="contact-name">Pascal Thubert</span>, and <span class="contact-name">Éric Vyncke</span> for their comments and feedback.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">This work was supported by the Sweden's Innovation Agency VINNOVA within the EUREKA CELTIC-NEXT project CYPRESS; and by the H2020 projects SIFIS-Home (Grant agreement 952652) and ARCADIAN-IoT (Grant agreement 101020259).<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Laurent Toutain</span></div>
<div dir="auto" class="left"><span class="org">IMT Atlantique</span></div>
<div dir="auto" class="left"><span class="street-address">CS 17607, 2 rue de la Chataigneraie</span></div>
<div dir="auto" class="left">
<span class="postal-code">35576</span> <span class="locality">Cesson-Sevigne Cedex</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:Laurent.Toutain@imt-atlantique.fr" class="email">Laurent.Toutain@imt-atlantique.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ivan Martinez</span></div>
<div dir="auto" class="left"><span class="org">Nokia Bell Labs</span></div>
<div dir="auto" class="left"><span class="street-address">12 Rue Jean Bart</span></div>
<div dir="auto" class="left">
<span class="postal-code">91300</span> <span class="locality">Massy</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ivan.martinez_bolivar@nokia-bell-labs.com" class="email">ivan.martinez_bolivar@nokia-bell-labs.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ana Minaburo</span></div>
<div dir="auto" class="left"><span class="org">Consultant</span></div>
<div dir="auto" class="left"><span class="street-address">Rue de Rennes</span></div>
<div dir="auto" class="left">
<span class="postal-code">35510</span> <span class="locality">Cesson-Sevigne</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:anaminaburo@gmail.com" class="email">anaminaburo@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
